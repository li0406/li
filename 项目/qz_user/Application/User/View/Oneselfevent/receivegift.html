<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>自发活动</title>
    <include file="Index:resource"/>
    <include file="Home:resource"/>
    <script type="text/javascript" src="/assets/user/event/js/jquery.smint.js?v={:C('STATIC_VERSION')}"></script>

    <link rel="stylesheet" href="/assets/common/plugin/datetimepicker/css/bootstrap.css?v={:C('STATIC_VERSION')}">
    <link rel="stylesheet" href="/assets/common/plugin/datetimepicker/css/bootstrap-datetimepicker.css?v={:C('STATIC_VERSION')}">
    <script type="text/javascript" src="/assets/common/plugin/datetimepicker/js/bootstrap-datetimepicker.js?v={:C('STATIC_VERSION')}"></script>
    <script type="text/javascript" src="/assets/common/plugin/datetimepicker/js/bootstrap-datetimepicker.zh-CN.js?v={:C('STATIC_VERSION')}"></script>

    <!--[if IE 7]>
    <link rel="stylesheet" href="css/font-awesome-ie7.min.css?v={:C('STATIC_VERSION')}">
    <![endif]-->
    <link rel="stylesheet" href="{$static_host}/assets/user/event/css/ht-gift.css?v={:C('STATIC_VERSION')}">
</head>
<body>
<include file="Home:header"/>

<div class="ht-wrap oflow ht-relative">
    <include file="Home:comnavleft"/>
    <include file="header"/>
    <!--<ul class="ht-nav-tit">
        <li class="active"><a href="/oneselfevent/">优惠活动</a></li>
        <li class="special-gift"><a href="/oneselfevent/special">专用礼券</a></li>
        <li class="common-gift"><a href="/oneselfevent/common">通用礼券</a></li>
    </ul>-->
    <div class="ht-main">
        <div class="table-list">
            <div class="c-common-gift">
                <table class="c-common-table">
                    <thead class="c-common-heaer">
                    <tr class="">
                        <th>礼券名称</th>
                        <th>立减金额</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody class="c-common-body">
                    <volist name="list" id="vo" >
                        <tr>
                            <td><a href="/oneselfevent/receivedetail/?id={$vo.id}" class="blue_1 cname">{$vo.name}</a></td>
                            <td class="cmoney">
                                <if condition="$vo['money1'] EQ 0">
                                    立减{$vo.money2|intval}
                                    <else/>
                                    {$vo.money1|intval}减{$vo.money2|intval}
                                </if>
                            </td>
                            <td class="green_1 c-receive" style="cursor: pointer;" data-id="{$vo.id}">领用</td>
                        </tr>
                    </volist>


                    </tbody>
                </table>
                <div>{$page}</div>
            </div>
        </div>
        <div class="mask" >
            <i class="fa fa-close close-mask"></i>
            <div class="gift-rules">
                <div class="reles-box" style="display: none;">
                    <p class="rules-title">齐装网优惠券营销规则</p>
                    <!--<div class="rules-content">
                        <h3>活动时间：</h3>
                        <p>以各优惠券指定的时间为准。</p>
                        <h3>活动参与对象</h3>
                        <p>通过齐装网平台预约装修公司成功的用户，凭预约时填写的手机号领取。</p>
                        <h3>活动方式</h3>
                        <p>1.用户在齐装网平台预约装修公司成功，并标记装修公司已量房后即可领取该公司的优惠券。</p>
                        <p>2.优惠券使用规则与有效期，以各优惠券券面显示及齐装网平台规则为准。优惠券数量有限，领完即止。</p>
                        <h3>规则说明</h3>
                        <p>1. 用户获得的优惠券将会自动发送至账户和用户手机号，是否获得优惠券以到账为准。</p>
                        <p>2. 活动过程中凡以不正当手段参与领券的用户，齐装网有权终止其参与活动，并取消其领取资格（如已发放，该券予以作废）。</p>
                        <p>3. 每张优惠券仅可使用一次。</p>
                        <p>4. 如遇不可抗力（包括但不限于重大灾害事件、活动受政府机关指令需要停办或整改的、活动中存在大面积作弊行为、活动遭受严重网络攻击或因系统故障导致中奖名单大批量出错等以致活动不能正常进行的），齐装网有权取消、修改或暂停本活动。</p>
                        <p>5. 用户应遵守国家法律、行政法规、部门规章等规范性文件。用户使用非法手段参与营销活动而获取非法利益的，应停止损害行为、返还并赔偿损失，可能涉嫌刑事犯罪的，齐装网一经发现将立即向司法机关报案。</p>
                    </div>-->
                    <div class="rules-content">
                        <h3>第一章  适用范围</h3>
                        <p>本规则适用于所有齐装网平台发起的优惠券营销活动，商家必须遵守以下规则，方可参加齐装网平台的优惠券营销活动。</p>
                        <h3>第二章 定义</h3>
                        <h4>2.1通用优惠券</h4>
                        <p>2.1.1通用优惠券是为装修业主提供的一种营销活动，由齐装网预先设定优惠内容及使用规则。各商家可自由参与该营销活动，开通并发放通用优惠券给装修业主领取和使用。</p>
                        <h4>2.1专用优惠券</h4>
                        <p>2.1.1专用优惠券是为装修业主提供的一种营销活动，由各商家自行定义优惠内容和使用规则，经齐装网工作人员审核通过即可发布至齐装网前端页面展示，装修业主领取后可至对应的装修门店进行使用。
                        </p>
                        <h3>第三章 优惠券信息发布规范</h3>
                        <h4>3.1优惠券价格和描述规范</h4>
                        <p>3.1.1优惠券的价格和描述必须真实并且符合逻辑，优惠价格一律以齐装网网站前端页面展示出来的价格为准。</p>
                        <p>3.1.2商家在经营活动的描述及宣传中，其内容应当提供真实、合法、准确客观的信息，不得使用含糊、易引起误解、以及广告法规定禁止使用的语言和文字，不得以保留最终解释权为由，损害消费者的合法权益。</p>
                        <h4>3.2优惠券的发布和退出</h4>
                        <p>3.2.1商家可自愿参与通用优惠券和专用优惠券的营销活动，通过商家用户中心自行上传或与齐装网平台的销售人员沟通后由销售人员代为上传，经齐装网工作人员审核通过后即可发布上线。</p>
                        <p>3.2.2商家可在用户中心下架优惠券营销活动或联系齐装网平台销售人员代为下架，下架后的优惠券信息将不再在显示在齐装网前端页面上。用户在商家下架前领取的优惠券，商家仍应按优惠券的内容履行服务。/p> 
                        <p>3.2.3商家下架优惠券后，若想再次发布，仍需要经过齐装网工作人员的审核通过后才可上线。</p>
                        <p>3.2.4为保证优惠活动的公平性、严肃性和稳定性，商家一旦自愿参与通用优惠券和专用优惠券的营销活动，在齐装网平台显示的优惠券领取期间内或备案的优惠券数量、金额领完前，商家无权自行在用户中心下架优惠券营销活动。如有特殊原因确需下架的，需要经过齐装网工作人员的审核通过后才可下架。</p>
                        <h4>3.3优惠券审核</h4>
                        <p>3.3.1商家参与优惠券促销活动并上传优惠券营销信息后，齐装网平台将对商家发布的优惠券信息进行审核，审核通过后即可在齐装网平台前端页面发布上线，并会通过商家用户中心的消息通知等方式告知商家，商家可在用户中心查看已发布的优惠券信息。</p>
                        <p>3.3.2如商家上传的优惠券信息不符合本规则中的规范，齐装网平台有权取消该优惠券的发布，并会通过商家用户中心的消息通知等方式告知商家不可上线的原因。</p>
                        <p>3.3.3对于审核不通过的优惠券信息，商家可以进行修改并再次上传，再次审核通过后即可发布上线至齐装网平台前端页面。</p>
                        <h3>第四章 附则</h3>
                        <p>4.1齐装网可根据平台运营情况随时调整本管理规则并向商家公示；商家在齐装网平台上发布优惠券促销信息即表示接受齐装网其后不时调整、颁布的管理规则。</p>
                        <p>4.2商家应遵守国家法律、行政法规、部门规章等规范性文件。对任何涉嫌违反国家法律、行政法规、部门规章等规范性文件的行为，本规则已有规定的，适用于本规则。本规则尚无规定的，齐装网有权酌情处理。但齐装网对商家的处理不免除其应承担的法律责任。商家在齐装网的任何行为，应同时遵守与齐装网及其关联公司签订的各项协议；如有违约即视为对本规则的违反。</p>
                        <p>4.3 本规则于2018年12月20日首次发布并生效。</p>
                    </div>
                    <div class="rules-check">
                        <label for="check-item">
                            <input type="checkbox" id="check-item" name="mianze">我已认真阅读并同意该协议
                        </label>
                    </div>
                    <button class="rules-btn " disabled>确认</button>
                </div>

                    <form id="myform" class="active-table" style="display: none;">
                    <ul class="active-info">
                        <li>
                            <span>礼券名称：</span>
                            <span id="card_name"></span>
                        </li>
                        <li>
                            <span>立减金额：</span>
                            <span id="card_money"></span>
                        </li>
                        <li>
                            <span><i class="red">*</i>活动开始时间：</span>
                            <input type="text" name="time_start" class="full in-focus timer3 form-control timer">
                        </li>
                        <li>
                            <span><i class="red">*</i>活动结束时间：</span>
                            <input type="text" name="time_end" class="full in-focus timer4 form-control timer">
                        </li>
                        <li>
                            <span><i class="red">*</i>有效时间-开始：</span>
                            <input type="text" name="hdtime_start" class="full in-focus timer1 form-control timer">
                        </li>
                        <li>
                            <span><i class="red">*</i>有效时间-结束：</span>
                            <input type="text" name="hdtime_end" class="full in-focus timer2 form-control timer">
                        </li>
                        <li>
                            <span><i class="red">*</i>领取数量：</span>
                            <input type="text" name="number" class="full in-focus in-num">
                        </li>
                        <input type="hidden" name="cardid">

                        <li class="btns">
                            <button class="btn sure-btn" type="button">确认</button>
                            <!--<button class="btn cancel-btn">取消</button>-->
                            <a class="btn cancel-btn" href="/oneselfevent/receivegift">取消</a>
                        </li>
                    </ul>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<include file="Index:footer"/>
<script>
    $(function () {

        $('.c-receive').on('click', function () {
            var that = $(this);
//            alert(that.parent().html());return;
            $("#card_name").text(that.parent().find('.cname').text());
            $("#card_money").text(that.parent().find('.cmoney').text());
            $('input[name=cardid]').val(that.data('id'));
            $('.mask').show();
            $('.reles-box').show();
        })
        $('.close-mask').on('click', function () {
            $('.mask').hide()
            $('.reles-box').hide()
            $('.active-table').hide()
            $('.rules-btn').removeClass('green')
            $('.rules-btn').attr('disabled', true)
            $('input[name = mianze]').prop('checked', false)
            $('.timer').val('')
        })
        $('input[name = mianze]').on('change', function () {
            var mianze = $('input[name = mianze]').prop('checked')
            if (mianze) {
                $('.rules-btn').addClass('green')
                $('.rules-btn').removeAttr('disabled')
            } else {
                $('.rules-btn').removeClass('green')
                $('.rules-btn').attr('disabled', true)
            }
        })
        $('.rules-btn').on('click', function () {
            $('.reles-box').hide()
            $('.active-table').show()

        })

        $('.timer').datetimepicker({
            format: 'yyyy-mm-dd hh:ii:00',
            language: 'zh-CN',
            autoclose: true,
            todayBtn: true
        });
       /* layui.use('laydate', function () {
            var laydate = layui.laydate;
            laydate.render({
                elem: '.timer1',
                type: 'datetime'

            })
            laydate.render({
                elem: '.timer2',
                type: 'datetime'
            })
            laydate.render({
                elem: '.timer3',
                type: 'datetime'
            })
            laydate.render({
                elem: '.timer4',
                type: 'datetime'
            })
        })*/
        $('.in-num').keyup(function () {
            var tmptxt = $(this).val();
            $(this).val(tmptxt.replace(/\D|^0/g, ''));
            if( tmptxt>99){
                $(this).val(99);
            }
        }).bind("paste", function () {
            var tmptxt = $(this).val();
            $(this).val(tmptxt.replace(/\D|^0/g, ''));
            if( tmptxt>99){
                $(this).val(99);
            }
        });
        $('.sure-btn').on('click', function () {
            $(".sure-btn").attr('disabled','disabled');
            var vs_time = $('.timer1').val(),
                ve_time = $('.timer2').val(),
                as_time = $('.timer3').val(),
                ae_time = $('.timer4').val();

            if (!vs_time) {
                msg('请选择有效开始时间');
                $(".sure-btn").removeAttr('disabled');
                return false
            }
            if (!ve_time) {
                msg('请选择有效结束时间');
                $(".sure-btn").removeAttr('disabled');
                return false
            }
            if (toTimeStamp(vs_time) > toTimeStamp(ve_time)) {
                msg('有效开始时间需要早于有效结束时间');
                $('input[name=hdtime_end]').val('')
                $(".sure-btn").removeAttr('disabled');
                return false
            }
            if (!as_time) {
                msg('请选择活动开始时间');
                $(".sure-btn").removeAttr('disabled');
                return false
            }
            if (!ae_time) {
                msg('请选择活动结束时间');
                $(".sure-btn").removeAttr('disabled');
                return false
            }
            if (toTimeStamp(as_time) > toTimeStamp(ae_time)) {
                msg('活动开始时间需要早于活动结束时间');
                $('input[name=time_end]').val('')
                $(".sure-btn").removeAttr('disabled');
                return false
            }

            if(toTimeStamp(as_time)>toTimeStamp(vs_time)){
                msg('活动开始时间需要早于等于有效开始时间');
                $(".sure-btn").removeAttr('disabled');
                return false;
            }

            if(toTimeStamp(ae_time)>toTimeStamp(ve_time)){
                msg('活动结束时间需要早于等于有效结束时间');
                $(".sure-btn").removeAttr('disabled');
                return false;
            }

            var obj = $('.in-num').val();
            var reg = /^\d+$/;
            if(obj == '') {
                msg('请填写领取数量');
                $(".sure-btn").removeAttr('disabled');
                return false;
            }

            if (obj != "" && !reg.test(obj)) {
                msg('数字框必须填写数字，且为整数');
                $(".sure-btn").removeAttr('disabled');
                return false;
            }

            var data = $('#myform').serializeArray();
            $.ajax({
                url: '/oneselfevent/receivegift/',
                type: 'POST',
                dataType: 'JSON',
                data: data
            })
                    .done(function(data) {
                        if(data.status == 0){
                            window.location.href = '/oneselfevent/common/';
                        }else{
                            msg(data.info);
                            $(".sure-btn").removeAttr('disabled');
                            return false;
                        }
                    })
                    .fail(function(xhr) {
                        msg("网络错误，请稍后重试！");
                    })

        })

    })

    function toTimeStamp(time) {
        if (time != undefined) {
            var date = time;
            date = date.substring(0, 19);
            date = date.replace(/-/g, '/');
            var timestamp = new Date(date).getTime();
            return timestamp;
        }
    };

    function msg(msg, fn) {
        layui.use('layer', function () {
            var layer = layui.layer;
            layer.msg(
                msg,
                {time: 5000,},
                fn || function () {
                }
            )
        })
    }
</script>
</body>
</html>
