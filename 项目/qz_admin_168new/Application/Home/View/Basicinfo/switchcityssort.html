<extend name="Main:baseTemplate"/>
<block name="style">
    <link href="/assets/home/basicinfo/css/switchcityssort.css?v={:C('STATIC_VERSION')}" rel="stylesheet" type="text/css" />
</block>
<block name="content">
    <div id="mainContent">
        <div class="top-menu">
            <div class="btn btn-default cur" id="py-menu">按照拼音排序</div>
            <div class="btn btn-default" id="sf-menu">按照省份排序</div>
        </div>
        <div class="panel panel-default">
            <div class="panel-body" style="padding: 10px;margin: 0px 0px 0px 0px;">
                <!-- S 按照拼音排序 -->
                <div class="panel panel-default" id="py-sort">
                    <div class="panel-body" style="padding: 10px;margin: 0px 0px 0px 0px;">
                        <div class="tableRow" style="width:1058px">
                            <volist name="cityInfo.accordCity" id="vo">
                                <div class="pyline clearfix">
                                    <div class="panel panel-default">
                                        <div class="panel-heading">
                                            <h3 class="panel-title"><dt>
                                                <span id="{$vo.pname}">{$vo.pname}</span>
                                            </dt></h3>
                                        </div>
                                        <div class="panel-body">
                                            <dd class="list-group clearfix">
                                                <volist name="vo.child" id="v">
                                                    <dl class="list-group-item <EQ name='v.mark_red' value='1'> list-group-item-danger</EQ>">
                                                        <a data-cid="{$v.cid}" title="{$v.cid}" style="<eq name='v.mark_red' value='1'>color: #de4348;</eq>" href="http://{$v.bm}.{:C('QZ_YUMING')}" target="_blank">{$v.cname}</a>
                                                        <input class="form-control ipt-comid px_abc" type="text" value="{$v.px_abc}">
                                                    </dl>
                                                </volist>
                                            </dd>
                                            <div><button type="submit" class="btn btn-primary update-py">保存</button></div>
                                        </div>
                                    </div>
                                </div>
                            </volist>
                        </div>
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                帮助说明
                            </div>
                            <div class="panel-body">
                                <table class="table">
                                    <thead>
                                    <tr>
                                        <th>项目</th>
                                        <th>说明</th>
                                        <th>补充</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>标红</td>
                                        <td>注意标红的会优先排序到前面, 设置标红是在 "城市基本设置当中"</td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>拼音排序编码规则</td>
                                        <td>共4位,小写首拼字母开头1位,数字3位,例子"苏州 s003",数字越大的排后面</td>
                                        <td></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="panel-footer row" style="margin: 0 0 0 0;">
                            </div>
                        </div>
                    </div>
                </div>
                <!-- E 按照拼音排序 -->
                <!-- S 按照省份排序 -->
                <div class="panel panel-default" id="sf-sort">
                    <div class="panel-body" style="padding: 10px;margin: 0px 0px 0px 0px;">
                        <div class="tableRow" style="width:1058px">
                            <volist name="cityInfo.allCity" id="vo">
                                <div class="sfline clearfix">
                                    <div class="panel panel-default">
                                        <div class="panel-heading">
                                            <h3 class="panel-title">
                                                <dt>
                                                    <span>{$vo.pname}({$vo.pid})</span>
                                                </dt>
                                            </h3>
                                        </div>
                                        <div class="panel-body">
                                            <dd class="list-group clearfix">
                                                <volist name="vo.child" id="v">
                                                    <dl class="list-group-item <eq name='v.mark_red' value='1'> list-group-item-danger</eq>">
                                                        <a data-cid="{$v.cid}" title="{$v.cid}" style="<eq name='v.mark_red' value='1'>color: #de4348;</eq>" href="http://{$v.bm}.{:C('QZ_YUMING')}" target="_blank">{$v.cname}({$v.plate})</a>
                                                        <input class="form-control ipt-comid" type="text" value="{$v.px}">
                                                    </dl>
                                                </volist>
                                            </dd>
                                            <div><button type="submit" class="btn btn-primary  update-sf">保存</button></div>
                                        </div>
                                    </div>
                                </div>
                            </volist>
                        </div>
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                帮助说明
                            </div>
                            <div class="panel-body">
                                <table class="table">
                                    <thead>
                                    <tr>
                                        <th>项目</th>
                                        <th>说明</th>
                                        <th>补充</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>标红</td>
                                        <td>注意标红的会优先排序到前面, 设置标红是在 "城市基本设置当中"</td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>省份排序编码规则</td>
                                        <td>共4位,省份代码前2位开头,数字2位,例子"苏州 3201"</td>
                                        <td></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="panel-footer row" style="margin: 0 0 0 0;">
                            </div>
                        </div>
                    </div>
                </div>
                <!-- E 按照省份排序 -->
            </div>
        </div>
    </div>
</block>

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <label></label>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel"></h4>
                <span class="tag header_error"></span>
            </div>
            <div class="modal-body">
            </div>
        </div>
    </div>
</div>
<block name="script">
    <script type="text/javascript">
        $(function() {
            // 切换拼音和省份
            $('#py-menu').click(function(){
                $(this).addClass('cur').siblings('div').removeClass('cur');
                $("#py-sort").show();
                $("#sf-sort").hide();
            });
            $('#sf-menu').click(function(){
                $(this).addClass('cur').siblings('div').removeClass('cur');
                $("#py-sort").hide();
                $("#sf-sort").show();
            });
            //保存 拼音
            $(".update-py").click(function(event) {
                var json        = {}; //定义json对象
                var list        = {};
                var thisobjline = $(this).parent().parent();
                json['type']    = 'py';
                $("dl>a", thisobjline).each(function(k,v){
                    var cid    = $(this).attr('data-cid');
                    var px_abc = $("input", $(this).parent()).val();
                    list[cid]  = px_abc;
                });
                json['px']   = list;
                console.log(json);

                $.ajax({
                    url: '/basicinfo/switchcityssortsave',
                    type: 'POST',
                    dataType: 'JSON',
                    data: json,
                })
                    .done(function(rejson) {
                        if (1 == rejson.status) {
                            alert(rejson.info);
                            window.location.reload();
                        } else {
                            alert(rejson.info);
                        };
                        //console.log("success");
                    })
                    .fail(function() {
                        console.log("error");
                    })
                    .always(function() {
                        console.log("complete");
                    });

                //console.log(cs)
            });

            //保存 省份
            $(".update-sf").click(function(event) {
                var json        = {}; //定义json对象
                var list        = {};
                var thisobjline = $(this).parent().parent();
                json['type']    = 'sf';
                $("dl>a", thisobjline).each(function(k,v){
                    var cid    = $(this).attr('data-cid');
                    var px_abc = $("input", $(this).parent()).val();
                    list[cid]  = px_abc;
                });
                json['px']   = list;
                console.log(json);

                $.ajax({
                    url: '/basicinfo/switchcityssortsave',
                    type: 'POST',
                    dataType: 'JSON',
                    data: json,
                })
                    .done(function(rejson) {
                        if (1 == rejson.status) {
                            alert(rejson.info);
                            window.location.reload();
                        } else {
                            alert(rejson.info);
                        };
                        //console.log("success");
                    })
                    .fail(function() {
                        console.log("error");
                    })
                    .always(function() {
                        console.log("complete");
                    });
            });


        });
    </script>
</block>
