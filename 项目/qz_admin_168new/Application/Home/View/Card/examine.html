<extend name="Main:baseTemplate" />
<block name="title">
    <title>审核</title>

</block>
<block name="style">
    <link rel="stylesheet" href="/assets/home/card/css/examine.css?v={:C('STATIC_VERSION')}" />
    <link rel="stylesheet" type="text/css" href="/assets/common/js/plugins/fileinput/fileinput.min.css?v={:C('STATIC_VERSION')}" />
    <link rel="stylesheet" type="text/css" href="/assets/common/plugins/bootstrap-switch/bootstrap-switch.min.css?v={:C('STATIC_VERSION')}" />
    <link rel="stylesheet" type="text/css" href="/assets/common/css/Alert.css?v={:C('STATIC_VERSION')}" />
</block>
<block name="content">
    <section class="content-header">
        <h1><a href="/card/special">专用礼券管理</a> > 审核</h1>
    </section>
    <section class="content-header">
        <div class="col-sm-12  content">
            <div class="col-sm-6">
                <form class="form-horizontal">
                    <div class="form-group text">
                        <label for="rule" class="col-sm-2 control-label">城市 :</label>
                        <div class="col-sm-10">
                            <p>{$info.cname}</p>
                        </div>
                    </div>
                    <div class="form-group text">
                        <label for="rule" class="col-sm-2 control-label">会员ID :</label>
                        <div class="col-sm-10">
                            <p>{$info.com_id}</p>
                        </div>
                    </div>
                    <div class="form-group text">
                        <label for="rule" class="col-sm-2 control-label">公司名称 :</label>
                        <div class="col-sm-10">
                            <p>{$info.qc}</p>
                        </div>
                    </div>
                    <div class="form-group text">
                        <label for="rule" class="col-sm-2 control-label">礼券名称 :</label>
                        <div class="col-sm-10">
                            <p>{$info.name}</p>
                        </div>
                    </div>
                    <div class="form-group text">
                        <label for="rule" class="col-sm-2 control-label">优惠活动 :</label>
                        <div class="col-sm-10">
                            <p>
                                <if condition="$info.active_type EQ 1">
                                    <if condition="$info.money1 NEQ 0">
                                        满{$info.money1|intval}减{$info.money2|intval}
                                        <else/>
                                        立减{$info.money2|intval}
                                    </if>
                                    <else/>
                                    满{$info.money3|intval}送{$info.gift}
                                </if>

                            </p>
                        </div>
                    </div>
                    <div class="form-group text">
                        <label for="rule" class="col-sm-2 control-label">使用规则 :</label>
                        <div class="col-sm-10">
                            <p>{$info.rule}</p>
                        </div>
                    </div>
                    <div class="form-group text">
                        <label for="rule" class="col-sm-2 control-label">发放数量 :</label>
                        <div class="col-sm-10">
                            <p>{$info.amount}</p>
                        </div>
                    </div>
                    <div class="form-group text">
                        <label for="rule" class="col-sm-2 control-label">有效时间 :</label>
                        <div class="col-sm-10">
                            <p>{$info.start|default=''|date='Y-m-d H:i:s',###} 至 {$info.end|default=''|date='Y-m-d H:i:s',###}</p>
                        </div>
                    </div>
                    <div class="form-group text">
                        <label for="rule" class="col-sm-2 control-label">活动时间 :</label>
                        <div class="col-sm-10">
                            <p>{$info.activity_start|default=''|date='Y-m-d H:i:s',###} 至 {$info.activity_end|default=''|date='Y-m-d H:i:s',###}</p>
                        </div>
                    </div>
                    <div class="form-group text">
                        <label for="rule" class="col-sm-2 control-label">上传时间 :</label>
                        <div class="col-sm-10">
                            <p>{$info.apply_time|default=''|date='Y-m-d H:i:s',###}</p>
                        </div>
                    </div>
                    <div class="form-group text">
                        <label for="rule" class="col-sm-2 control-label">礼券图片 :</label>
                        <div class="col-sm-10 pcmobileimg">
                            <span>pc端</span>
                            <div class="img">
                                <div class="left">
                                    <div class="top">
                                        <if condition="$info['active_type'] EQ 2">
                                            <div class="letext">
                                                <span id="card_money2">{$info.gift}</span>
                                            </div>
                                            <div class="ritext">
                                                <p>满{$info.money3|intval}送{$info.gift}</p>
                                            </div>
                                        <else/>
                                            <div class="letext">
                                                ￥<span id="card_money2">{$info.money2|intval}</span>
                                            </div>
                                            <div class="ritext">
                                                <p>
                                                    <if condition="$info['money1'] NEQ 0">满{$info.money1|intval}减{$info.money2|intval}
                                                        <else/>立减{$info.money2|intval}
                                                    </if>
                                                </p>
                                            </div>
                                        </if>
                                    </div>
                                    <div class="bottom">
                                        使用时间 : <span class="start" id="card_start">{$info.start|default=''|date='Y-m-d',###}</span> ~ <span class="end" id="card_end">{$info.end|default=''|date='Y-m-d',###}</span>
                                    </div>
                                </div>
                                <div class="right">
                                </div>
                            </div>
                            <span>移动端</span>
                            <div class="img2">
                                <div class="lingqu">
                                    立即领取
                                </div>
                                <div class="top">
                                    <if condition="$info['active_type'] EQ 2">
                                        <div class="left"><span>{$info.gift}</span></div>
                                        <div class="right">
                                            <span> 满{$info.money3|intval}送{$info.gift}</span>
                                        </div>
                                    <else/>
                                        <div class="left">￥<span>{$info.money2|intval}</span></div>
                                        <div class="right">
                                            <span>
                                                <if condition="$info['money1'] NEQ 0">满{$info.money1|intval}减{$info.money2|intval}
                                                    <else/>立减{$info.money2|intval}
                                                </if>
                                            </span>
                                        </div>
                                    </if>
                                </div>
                                    <div class="bottom">
                                            使用时间 : <span class="start">{$info.start|date='Y-m-d',###}</span> ~ <span class="end">{$info.end|date='Y-m-d',###}</span>
                                    </div>
                                    
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <input type="hidden" name="id" value="{$info.id}">
                            <label for="rule" class="col-sm-2 control-label">审核意见 :</label>
                            <div class="col-sm-10">
                                <textarea name="reason" id="rule" maxlength="100" cols="100" rows="8"></textarea>
                            </div>
                        </div>
    
                        <div class="form-group">
                            <div class="col-sm-offset-2">
                                <button type="button" class="btn btn-success" style="width:100px">审核通过</button>
                                <button type="button" class="btn btn-warning" style="width:100px;margin-left: 50px">不通过</button>
                                <button type="button" class="btn btn-default" style="width:100px;margin-left: 50px">取消</button>
                            </div>
                        </div>
                    </div>

                    

                </form>
            </div>
        </div>


    </section>
</block>
<block name="script">
    <script type="text/javascript" src="/assets/common/js/plugins/fileinput/fileinput.js?v={:C('STATIC_VERSION')}"></script>
    <script type="text/javascript" src="/assets/common/js/plugins/fileinput/fileinput_locale_zh.js?v={:C('STATIC_VERSION')}"></script>
    <script type="text/javascript" src="/assets/common/plugins/bootstrap-switch/bootstrap-switch.min.js?v={:C('STATIC_VERSION')}"></script>
    <script type="text/javascript" src="/assets/common/js/Alert.js?v={:C('STATIC_VERSION')}"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('input').attr('autocomplete','off')
            // 审核通过
            $('.btn-success').on('click', function () {
                $(this).attr('disabled','disabled');
                checkStatus(2);
            })

            // 审核不通过
            $('.btn-warning').on('click', function () {
                $(this).attr('disabled','disabled');
                checkStatus(3);
            })

            // 取消
            $('.btn-default').on('click', function () {
                location.href = '/card/special'
            })


            function checkStatus(status){
                var id = $('input[name=id]').val();
                var reason = $('#rule').val();
                if(status == 3 && reason.trim() == ''){
                    $('.btn-warning').removeAttr('disabled');
                    alert('请输入审核意见');
                }else{
                    $.ajax({
                        url: '/card/examine/',
                        type: 'POST',
                        dataType: 'JSON',
                        data: {id:id,reason:reason,status:status,type:2}
                    })
                            .done(function(data) {
                                if(data.status == 0){
                                    window.location.href='/card/special/';
                                }else{
                                    $('.btn-warning').removeAttr('disabled');
                                    $('.btn-success').removeAttr('disabled');
                                    alert(data.info);
                                    return false;
                                }
                            })
                            .fail(function(xhr) {
                                alert("网络错误，请稍后重试！");
                            })

                }


            }
        });
    </script>
</block>