<!--广告位列表-->
<extend name="Main:baseTemplate"/>
<block name="style">
    <link rel="stylesheet"
          href="/assets/common/js/plugins/select2/select2.min.css?v={:C('STATIC_VERSION')}">
    <link rel="stylesheet" href="/assets/home/adposition/css/adposlist.css?v={:C('STATIC_VERSION')}">

</block>
<block name="content">
    <section class="content-header">
        <a href="/advposition/adv_option/" class="btn btn-default">投放广告</a>
        <a href="/advposition/position/" class="btn btn-success">广告位管理</a>
        <ol class="breadcrumb">
            <li><a href="/"><i class="fa fa-dashboard"></i> 控制面板</a></li>
            <li><a href="/advposition/position/">广告位管理</a></li>
        </ol>
    </section>
    <section class="content">
        <div class="row">
            <div class="col-xs-12">
                <div class="box box-default">
                    <div class="box-body">
                        <div class="row">
                            <form class="form-horizontal">
                                <div class="col-xs-12">
                                    <div class="col-xs-1  reset-width">
                                        <div>广告位</div>
                                        <input type="text" name="keywords" class="form-control clear-target" autocomplete="off"
                                               placeholder=" 广告位名称/id" value="{$param.keywords}">
                                    </div>
                                    <div class="col-xs-1  reset-width">
                                        <div>平台</div>
                                        <select name="platform_id" class="select_platform form-control">
                                            <option value="">请选择</option>
                                            <volist name="platform_list" id="item">
                                                <option value="{$item.id}"
                                                <eq name="param.platform_id" value="$item['id']">selected</eq>
                                                >{$item.name}</option>
                                            </volist>
                                        </select>
                                    </div>
                                    <div class="col-xs-1  reset-width">
                                        <div>模块</div>
                                        <select name="module_id" class="select_module form-control">
                                            <option value="">请选择</option>
                                            <volist name="module_list" id="item">
                                                <option value="{$item.id}"
                                                <eq name="param.module_id" value="$item['id']">selected</eq>
                                                >{$item.name}</option>
                                            </volist>
                                        </select>
                                    </div>
                                    <div class="col-xs-1  reset-width">
                                        <div>页面</div>
                                        <select name="page_id" class="select_page form-control">
                                            <option value="">请选择</option>
                                            <volist name="page_list" id="item">
                                                <option value="{$item.id}"
                                                <eq name="param.page_id" value="$item['id']">selected</eq>
                                                >{$item.name}</option>
                                            </volist>
                                        </select>
                                    </div>
                                    <div class="col-xs-1  reset-width">
                                        <div>位置</div>
                                        <select name="position_id" class="select_position form-control">
                                            <option value="">请选择</option>
                                            <volist name="position_list" id="item">
                                                <option value="{$item.id}"
                                                <eq name="param.position_id" value="$item['id']">selected</eq>
                                                >{$item.name}</option>
                                            </volist>
                                        </select>
                                    </div>
                                    <div class="col-xs-1  reset-width">
                                        <div>状态</div>
                                        <select name="enabled" class="platform form-control">
                                            <option value="">请选择</option>
                                            <option value="1"
                                            <eq name="param.enabled" value="1">selected</eq>
                                            >启用</option>
                                            <option value="2"
                                            <eq name="param.enabled" value="2">selected</eq>
                                            >停用</option>
                                        </select>
                                    </div>
                                    <div class="col-xs-1  reset-width pt17">
                                        <button type="submit" id="" class="btn btn-success col-xs-5 mr10">搜索</button>
                                        <button type="button" id="" class="btn resetbtn col-xs-5">重置
                                        </button>
                                    </div>
                                    <div class="col-xs-1 reset-width pt17">
                                        <button type="button" class="btn btn-success col-xs-8"
                                                onclick="window.location='/advposition/add_position'">添加广告位
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xs-12">
                <div class="box">
                    <div class="box-body" id="data_list">
                        <table class="table table-hover table-bordered" id="tablelist">
                            <thead>
                            <tr>
                                <th>id</th>
                                <th class="width-14">广告位名称</th>
                                <th>广告样式</th>
                                <th class="width-14">平台</th>
                                <th class="width-14">模块</th>
                                <th class="width-14">页面</th>
                                <th class="width-14">位置</th>
                                <th>状态</th>
                                <th class="width-210">操作</th>
                            </tr>
                            </thead>
                            <tbody>
                            <volist name="list" id="item">
                                <tr>
                                    <td class="order-time">{:sprintf("%06d", $item["id"])}</td>
                                    <td class="order-remark-table">
                                        <a href="/advposition/position_detail?id={$item.id}">{$item.name}</a>
                                    </td>
                                    <td>{$item.type_name}</td>
                                    <td>{$item.platform_name}</td>
                                    <td>{$item.module_name}</td>
                                    <td>{$item.page_name}</td>
                                    <td>{$item.position_name}</td>
                                    <td>{$item.enabled_name}</td>
                                    <td class="operater-table">
                                        <a href="/advposition/position_detail?id={$item.id}">
                                            <span title="查看" class="fa fa-eye"></span>
                                        </a>
                                        <a href="/advposition/add_position?id={$item.id}">
                                            <span title="编辑" class="fa fa-pencil"></span>
                                        </a>
                                        <a href="javascript:void(0);" class="btn_del" data-id="{$item.id}">
                                            <span title="删除" class="fa fa-trash"></span>
                                        </a>
                                    </td>
                                </tr>
                            </volist>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>
</block>
<block name="script">
    <script type="text/javascript">
        $(".resetbtn").on("click", function () {
            $(".clear-target").val("")
            $("select").each(function (i, n) {
                $(this).val("");
            });

            var html = '<option value="">请选择</option>';
            $(".select_module,.select_page,.select_position").html(html);
        })

        $(function () {
            // 删除操作(需要验证后二次弹窗)
            function positionDelete(id, confirms) {
                $.post("/advposition/position_delete", {
                    id: id,
                    confirm: confirms || 0
                }, function (result) {
                    if (result.status == 1) {
                        if (confirms == 1) {
                            window.location.reload();
                        } else if (window.confirm("是否确认删除此广告位") == true) {
                            positionDelete(id, 1);
                        }
                    } else {
                        alert(result.info);
                    }
                });
            }

            // 删除
            $("#data_list").on("click", ".btn_del", function () {
                var id = $(this).data("id");
                positionDelete(id);
            });

            // 获取平台-模块-页面-位置联动数据
            function getPositionOptionChildren(id, callback) {
                var html = '<option value="">请选择</option>';

                if (id == "") {
                    callback(html);
                    return;
                }

                // 数据请求
                $.get("/advposition/get_adv_position_option", {id: id}, function (result) {
                    if (result.status == 1) {
                        var list = result.data;
                        for (var i in list) {
                            html += '<option value="' + list[i]["id"] + '">' + list[i]["name"] + '</option>';
                        }

                        callback(html);
                    }
                });
            }

            // 平台选择
            $(".select_platform").on("change", function () {
                var id = $(this).val();
                getPositionOptionChildren(id, function (optionHtml) {
                    $(".select_module").html(optionHtml);

                    var html = '<option value="">请选择</option>';
                    $(".select_page").html(html);
                    $(".select_position").html(html);
                });
            });

            // 模块选择
            $(".select_module").on("change", function () {
                var id = $(this).val();
                getPositionOptionChildren(id, function (optionHtml) {
                    $(".select_page").html(optionHtml);

                    var html = '<option value="">请选择</option>';
                    $(".select_position").html(html);
                });
            });

            // 页面选择
            $(".select_page").on("change", function () {
                var id = $(this).val();
                getPositionOptionChildren(id, function (optionHtml) {
                    $(".select_position").html(optionHtml);
                });
            });

        });
    </script>
</block>
