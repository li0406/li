<section class="content">
    <div class="row">
        <div class="col-xs-12">
            <div class="box">
                <div class="box-body table-responsive no-padding">
                    <!-- 第一列 -->
                    <form id="myForm" class="col-xs-4 border-r padding5">
                        <div class="basic_info">
                            <div class="col-xs-12 no-padding mt3">
                                <span class="width_size">发布时间：</span>
                                <span>{$info.time}</span>
                                <button id="copy" type="button" class="width_60 zclip"><i class="fa fa-files-o"></i>复制
                                </button>
                            </div>
                            <if condition="in_array($info['source'],array(18082757))">
                                <div class="col-xs-12 no-padding">
                                    <div class="col-xs-6 no-padding">
                                        <span class="width_size">页面来源：</span>
                                        <select name="source_type" class="width_80">
                                            <option value="18082757">上门量房</option>
                                        </select>
                                    </div>
                                </div>
                            </if>
                            <div class="col-xs-12 no-padding mt3">
                                <span class="width_size">&nbsp;IP城市：</span>
                                <span>{$info.cname_ip}</span>
                                <span style="margin-left: 70px">订单来源：</span>
                                <span>
                                    <if condition="!empty($info['source_in'])">
                                        <volist name="orderType" id="v">
                                            <if condition="$info['source_in'] eq $v['id']">
                                                {$v.type_name}
                                            </if>
                                        </volist>
                                    <else/>
                                        默认
                                    </if>
                                </span>
                            </div>
                            <div class="col-xs-12 no-padding mt3">
                                <span class="width_size">手机号码：</span>
                                <span>{$info.tel}</span>
                                <span style="margin-left: 12px;">
                                    <a href="/voip/voiprecord?id={$info.id}" title="voip电话记录"
                                        class="relation_icon icon_list" target="_blank"></a>
                                <if condition="$logCount GT 0">
                                    <a title="短信已发送" href="javascript:void(0)"
                                        class="relation_icon icon_email icon_email_disabled"></a>
                                <else/>
                                    <a id="icon_email" title="发送短信" href="javascript:void(0)"
                                        class="relation_icon icon_email"></a>
                                </if>
                                <if condition="$info['openeye_st'] EQ NULL">
                                    <a id="icon_eye" href="javascript:void(0)" class="relation_icon icon_eye"
                                        title="申请显号"></a>
                                <else/>
                                    <a href="javascript:void(0)" class="relation_icon icon_eye icon_eye_disabled"
                                        title="该号码已申请显号"></a>
                                </if>
                                <a title="百度搜索" href="/orders/tel_baidusearch?id={$info.id}"
                                   class="relation_icon icon_baidu" target="_blank"></a>
                                <a title="360搜索" href="/orders/tel_360search?id={$info.id}"
                                   class="relation_icon icon_360" target="_blank"></a>
                                <a title="搜狗搜索" href="/orders/tel_sogousearch?id={$info.id}"
                                   class="relation_icon icon_sogou" target="_blank"></a>
                                <a title="神马搜索" href="/orders/tel_smsearch?id={$info.id}" class="relation_icon icon_sm"
                                   target="_blank"></a>
                            </span>
                            </div>
                            <div class="col-xs-12 no-padding">
                                <span class="width_size">微信号：</span>
                                <input class="width_150" type="text" id="contact_wx" name="contact_wx"
                                       value="{$info.wx_show|default=''}">
                                <input type="checkbox" id="equalphone" name="same_tel" value="1"> <label
                                    for="equalphone">手机同号</label>
                                <input type="checkbox" id="onlybywx" name="is_wx" value="1"
                                <if condition="$info['is_wx'] == 1">checked</if>
                                > <label for="onlybywx">要求微信联系</label>
                            </div>
                            <div class="col-xs-12 no-padding">
                                <span class="width_size" style="width: 85px;">备用联系方式：</span>
                                <input class="width_150" type="text" id="other_contact" name="other_contact"
                                       value="{$info['other_contact']}">
                                <span id="other_contact_span" style="color:red"></span>
                            </div>
                            <div class="col-xs-12 no-padding">
                                <span class="width_size" style="width: 85px;">备用联系人：</span>
                                <input class="width_150" type="text" id="standby_user" name="standby_user"
                                       value="{$info['standby_user']}">
                            </div>
                            <div class="col-xs-12 no-padding mt3">
                                <span class="width_size">房屋地址：</span>
                                <input class="width_100" type="text" name="dz" value="{$info.dz}">
                            </div>
                            <div class="col-xs-12 no-padding mt3">
                                <span class="width_size"><i class="red">*</i>联系人：</span>
                                <input class="width_100" type="text" name="name" value="{$info.name}">
                                <select name="sex" id="">
                                    <if condition="$info['sex'] EQ '先生'">
                                        <option value="">性别</option>
                                        <option value="先生" selected="selected">先生</option>
                                        <option value="女士">女士</option>
                                        <elseif condition="$info['sex'] EQ '女士' "/>
                                        <option value="">性别</option>
                                        <option value="先生">先生</option>
                                        <option value="女士" selected="selected">女士</option>
                                        <else/>
                                        <option value="">性别</option>
                                        <option value="先生">先生</option>
                                        <option value="女士">女士</option>
                                    </if>
                                </select>
                            </div>
                            <div id="order-form">
                                <div class="col-xs-12 no-padding mt3">
                                    <span class="width_size">所属区域：</span>
                                    <span>{$city[0]["cname"]}</span>
                                    <input type="hidden" name="cs" value="{$info['cs']}">
                                    <select class="width_80" name="qx">
                                        <option value="">-请选择-</option>
                                        <volist name="city" id="vo">
                                            <if condition="$vo['qz_areaid'] EQ $info['qx']">
                                                <option value="{$vo.qz_areaid}" selected="selected">{$vo.qz_area}
                                                </option>
                                                <else/>
                                                <option value="{$vo.qz_areaid}">{$vo.qz_area}</option>
                                            </if>
                                        </volist>
                                    </select>
                                    <button id="history" type="button" class="bgcolor"><i class="fa fa-tag"></i>无</button>
                                </div>
                                <div class="col-xs-12 no-padding">

                                    <select name="xiaoqutype" style="width:60px;" disabled>
                                        <if condition="$info['xiaoqu_type'] EQ 1">
                                            <option class="width_size" selected value="1">小区</option>
                                            <else/>
                                            <option class="width_size" value="1">小区</option>
                                        </if>
                                        <if condition="$info['xiaoqu_type'] EQ 2">
                                            <option class="width_size" selected value="2">道路</option>
                                            <else/>
                                            <option class="width_size" value="2">道路</option>
                                        </if>
                                        <if condition="$info['xiaoqu_type'] EQ 3">
                                            <option class="width_size" selected value="3">其他</option>
                                            <else/>
                                            <option class="width_size" value="3">其他</option>
                                        </if>
                                    </select>
                                    <input class="width_90 xiaoqu-entry" type="text" name="xiaoqu" autocomplete="off"
                                           value="{$info.xiaoqu}" maxlength="20" style="height:20px;">
                                    <div class="xiaoqu-box">

                                        <ul id="xiaoqu_ul">

                                        </ul>
                                    </div>
                                    <span>坐标：</span>

                                    <input class="width_130" type="text" name="zuobiao" style="height:20px;"
                                           value="{$info.jingwei}">
                                    <a href="https://api.map.baidu.com/lbsapi/getpoint/index.html"
                                       style="margin-left:10px;margin-top:-3px;" target="_blank"><img
                                            src="/assets/common/img/location.jpg" style="width:17px;"/></a>
                                </div>
                                <div class="col-xs-12 no-padding mt3">
                                    <span class="width_size">装修类型：</span>
                                    <select name="lx" class="width_70">
                                        <option value="">-请选择-</option>
                                        <if condition="$info['lx'] EQ 2">
                                            <option value="2" selected="selected">公装</option>
                                            <option value="1">家装</option>
                                            <elseif condition="$info['lx'] EQ 1"/>
                                            <option value="2">公装</option>
                                            <option value="1" selected="selected">家装</option>
                                            <else/>
                                            <option value="2">公装</option>
                                            <option value="1">家装</option>
                                        </if>
                                    </select>
                                    <select name="lxs" class="width_80">
                                        <option value="">-请选择-</option>
                                        <volist name="lxs" id="vo">
                                            <if condition="$key EQ $info['lxs']">
                                                <option value="{$key}" selected="selected">{$vo}</option>
                                                <else/>
                                                <option value="{$key}">{$vo}</option>
                                            </if>
                                        </volist>
                                    </select>
                                </div>
                                <div class="col-xs-12 no-padding mt3">
                                    <span class="width_size">户型结构：</span>
                                    <select name="huxing" class="width_100">
                                        <option value="">-请选择-</option>
                                        <volist name="huxing" id="vo">
                                            <if condition="$vo['id'] EQ $info['huxing']">
                                                <option value="{$vo.id}" selected="selected">{$vo.name}</option>
                                                <else/>
                                                <option value="{$vo.id}">{$vo.name}</option>
                                            </if>
                                        </volist>
                                    </select>
                                    <select name="shi" class="width_50">
                                        <volist name="shi" id="vo">
                                            <if condition="$vo EQ $info['shi']">
                                                <option value="{$key}" selected="selected">{$vo}</option>
                                                <else/>
                                                <option value="{$key}">{$vo}</option>
                                            </if>
                                        </volist>
                                    </select>
                                    <span>室</span>
                                    <span>面积：</span>
                                    <input class="width_60" type="number" name="mianji" value="{$info.mianji}">㎡
                                </div>
                                <div class="col-xs-12 no-padding mt3">
                                    <span class="width_size">风格：</span>
                                    <select name="fengge" class="width_70">
                                        <option value="">-请选择-</option>
                                        <volist name="fengge" id="vo">
                                            <if condition="$vo['id'] EQ $info['fengge']">
                                                <option value="{$vo.id}" selected="selected">{$vo.name}</option>
                                                <else/>
                                                <option value="{$vo.id}">{$vo.name}</option>
                                            </if>
                                        </volist>
                                    </select>
                                    <span>预算：</span>
                                    <select class="width_70" name="fangshi">
                                        <option value="">-请选择-</option>
                                        <volist name="fangshi" id="vo">
                                            <if condition="$vo['id'] EQ $info['fangshi']">
                                                <option value="{$vo.id}" selected="selected">{$vo.name}</option>
                                                <else/>
                                                <option value="{$vo.id}">{$vo.name}</option>
                                            </if>
                                        </volist>
                                    </select>
                                    <select class="width_70" name="yusuan">
                                        <option selected="" value="">-请选择-</option>
                                        <volist name="yusuan" id="vo">
                                            <if condition="$vo['id'] EQ $info['yusuan']">
                                                <option value="{$vo.id}" selected="selected">{$vo.name}</option>
                                                <else/>
                                                <option value="{$vo.id}">{$vo.name}</option>
                                            </if>
                                        </volist>
                                    </select>
                                </div>
                                <div class="col-xs-12 no-padding mt3">
                                    <span class="width_size">拿房时间：</span>
                                    <input type="text" name="nf_time" class="lf_datepicker inputer width_100"
                                           value="{$info['nf_time']}">
                                    <span class="width_size">钥匙：</span>
                                    <select class="key_select width_70" name="keys">
                                        <option value="">-请选择-</option>
                                        <volist name="keys" id="vo">
                                            <if condition="$key EQ $info['keys']">
                                                <option value="{$key}" selected="selected">{$vo}</option>
                                                <else/>
                                                <option value="{$key}">{$vo}</option>
                                            </if>
                                        </volist>
                                    </select>
                                </div>
                                <div class="col-xs-12 no-padding mt3">
                                    <span class="width_size" style="width: 70px">量房/到店：</span>
                                    <select class="width_100" name="lftime">
                                        <option value="">-请选择-</option>
                                        <volist name="lf_time" id="vo">
                                            <if condition="$vo EQ $info['lftime']">
                                                <option value="{$vo}" selected="selected">{$vo}</option>
                                                <else/>
                                                <option value="{$vo}">{$vo}</option>
                                            </if>
                                        </volist>
                                    </select>
                                    <span class="width_size">开工时间：</span>
                                    <select class="width_100" name="start">
                                        <option value="">-请选择-</option>
                                        <volist name="start_time" id="vo">
                                            <if condition="$vo EQ $info['start']">
                                                <option value="{$vo}" selected="selected">{$vo}</option>
                                                <else/>
                                                <option value="{$vo}">{$vo}</option>
                                            </if>
                                        </volist>
                                    </select>
                                </div>
                            </div>
                            <div class="col-xs-12 no-padding mt3">
                                <span class="width_size pull-left">特殊需求：</span>
                                <textarea class="pull-left text-height120" name="text" style="line-height: 12px;">{$info.text}</textarea>
                            </div>
                            <div class="col-xs-12 no-padding mt3">
                                <span class="width_size pull-left">回访记录：</span>
                                <textarea class="pull-left text-height60" name="huifan">{$info.huifan}</textarea>
                            </div>
                            <div class="col-xs-12 no-padding">
                                <div class="col-xs-6">
                                    <span class="width_size">待定时间：</span>
                                    <input type="text" name="visitime" class="datepicker width_150"
                                           value="{$info['visitime']}" style="height: 20px;" readonly="readonly">
                                    <span class="remove_btn" style="color: #3399FF; cursor: pointer">清除</span>
                                </div>
                                <div class="col-xs-6">
                                    <span class="width_size">回访时间：</span>
                                    <input type="text" name="review_time" class="hf_datepicker width_150"
                                           value="{:!empty($info['review_time'])?date('Y-m-d',$info['review_time']):''}"
                                           style="height: 20px;" readonly="readonly">
                                    <span class="remove_hf_btn" style="color: #3399FF; cursor: pointer">清除</span>
                                </div>

                            </div>
                            <div class="col-xs-12 no-padding mt5">
                                <span class="width_size">编辑人：</span>
                                <span>{$info.customer}</span>

                                <present name="apply.status">
                                    <if condition="($apply['status'] eq 2) AND ($apply['save_state'] eq 1)">
                                        <button id="btnSave" type="button"
                                                class="btn btn-info btn-sm pull-right width_60">①保存
                                        </button>
                                    </if>
                                <else/>
                                    <button id="btnEdits" type="button" class="btn btn-info btn-sm pull-right width_60">
                                        修改
                                    </button>
                                </present>
                            </div>
                            <div class="col-xs-12 no-padding border-t mt3">
                                <span class="red">*</span>
                                <span>分配上限：</span>
                                <input type="radio" name="march-num" class="march-num" id="four-mar"
                                <if condition="$info['allot_num'] EQ 4 OR empty($info['allot_num'])">checked</if>
                                disabled/><label for="four-mar">4家</label>
                                <input type="radio" name="march-num" class="march-num" id="three-mar"
                                <if condition="$info['allot_num'] EQ 3">checked</if>
                                disabled/><label for="three-mar">3家</label>
                                <input type="radio" name="march-num" class="march-num" id="two-mar"
                                <if condition="$info['allot_num'] EQ 2">checked</if>
                                disabled/><label for="two-mar">2家</label>
                                <input type="radio" name="march-num" class="march-num" id="one-mar"
                                <if condition="$info['allot_num'] EQ 1">checked</if>
                                disabled/><label for="one-mar">1家</label>
                            </div>
                            <div class="col-xs-12 no-padding mt3">
                                <span class="width_size">当前状态：</span>
                                <span class="red">
                            <if condition="$info['on'] EQ 0 AND $info['on_sub'] EQ 10">
                            新单
                            <elseif condition="$info['on'] EQ 0 AND $info['on_sub'] EQ 9"/>
                            次新单
                            <elseif condition="$info['on'] EQ 2"/>
                            待定
                            <elseif condition="$info['on'] EQ 4 AND $info['type_fw'] EQ 0"/>
                            有效未分配
                            <elseif condition="$info['on'] EQ 4 AND $info['type_fw'] EQ 1"/>
                            分单
                            <elseif condition="$info['on'] EQ 4 AND $info['type_fw'] EQ 2"/>
                            赠单
                            <elseif condition="$info['on'] EQ 4 AND $info['type_fw'] EQ 3"/>
                            分没人跟
                            <elseif condition="$info['on'] EQ 4 AND $info['type_fw'] EQ 4"/>
                            赠没人跟
                            <elseif condition="$info['on'] EQ 4 AND $info['type_fw'] EQ 5"/>
                            待分配分单
                            <elseif condition="$info['on'] EQ 4 AND $info['type_fw'] EQ 6"/>
                            待分配赠单
                            <elseif condition="$info['on'] EQ 0 AND $info['on_sub'] EQ 8"/>
                            扫单
                            <elseif condition="$info['on'] EQ 5"/>
                            无效
                            <else/>
                            未知
                            </if>
                            <i class="fa fa-long-arrow-right mr10"></i></span>
                                <select name="state" class="select_order_state width_90">
                                    <option value="">请选择</option>
                                    <volist name="status" id="vo">
                                        <option value="remark_{$vo.id}">{$vo.name}</option>
                                    </volist>
                                </select>
                                <volist name="status" id="vo" key="$key">
                                    <if condition="count($vo['child']) GT 0">
                                        <if condition="$key EQ 0">
                                            <select id="remark_{$vo.id}" class="select_order_item width_150">
                                        <else/>
                                            <select id="remark_{$vo.id}" class="select_order_item width_150 hide_select">
                                        </if>
                                        <option value="">-请选择备注-</option>
                                        <volist name="vo.child" id="v" key="k">
                                            <if condition="$v EQ $info['remarks']">
                                                <option value="{$v}" selected="selected">{$v}</option>
                                            <else/>
                                                <option value="{$v}">{$v}</option>
                                            </if>
                                        </volist>
                                        </select>
                                    </if>
                                </volist>
                            </div>
                            <div class="col-xs-12 no-padding mt3">
                                <span>审核人：</span>
                                <span>{$csos_new.user_name}</span>
                                <button id="btnCheck" type="button" class="btn btn-info btn-sm pull-right width_60">
                                    ②审核
                                </button>
                            </div>
                        </div>
                    </form>
                    <!-- 第二列 -->
                    <div class="col-xs-4 border-r padding10">
                        <div class="col-xs-12 no-padding mt3">
                            <span>分单人：</span>
                            <if condition="$info['on'] EQ 4">
                                <span>{$info.fen_customer}</span>
                            </if>
                            <span>分配状态：</span>
                            <if condition="$info['on'] EQ 4 AND $info['type_fw'] EQ 1">
                                <span>分</span>
                                <elseif condition="$info['on'] EQ 4 AND $info['type_fw'] EQ 2"/>
                                <span>赠</span>
                                <else/>
                            </if>
                            <a href="/map/mapmarker?id={$info.id}" target="_blank"
                               class="btn btn-info btn-sm pull-right">地图辅助</a>
                            <a href="javascript:void(0)" class="btn btn-sm pull-right cursor modifyrizhi"
                               data-id="{$info.id}">修改日志</a>
                        </div>
                        <div class="col-xs-12 no-padding mt3">
                            <if condition="$info['on'] EQ 4 AND $info['type_fw'] EQ 2 AND $info['order_to_new'] NEQ 2">
                                <button id="btnNoNew" type="button" class="btn btn-info btn-sm pull-right width_100"
                                        value="{$info.id}" title="赠送订单,再访后还是不能成为新订单">不能生成新单
                                </button>
                                <button id="btnNew" type="button" class="btn btn-info btn-sm pull-right width_80"
                                        value="{$info.id}" title="赠送订单,再访有效后生成一个新的订单">生成新单
                                </button>
                            </if>
                        </div>
                        <div class="col-xs-12 no-padding mt3">
                            <span>已分配公司：</span>
                            <button id="copy-company" type="button" class="width_60 zclip"><i class="fa fa-files-o"></i>复制
                            </button>
                            <span>群公布模板：</span>
                            <select id="template" class="width_80">
                                <option value="">请选择</option>
                                <volist name="notice" id="vo">
                                    <option value="{$vo.id}">{$vo.title}</option>
                                </volist>
                            </select>
                            <button id="copy-template" type="button" class="width_60 zclip" data-id="{$info.id}"><i
                                    class="fa fa-files-o"></i>复制
                            </button>
                        </div>
                        <div class="col-xs-12 no-padding mt3 wx_company_list" style="min-height: 75px;">
                            <volist name="company" id="vo">
                                <div class="col-xs-6 no-padding">
                                    <div class="lh16">
                                        <if condition="$vo['type_fw'] EQ 1">
                                            <span>分</span>
                                        <else/>
                                            <span>赠</span>
                                        </if>
                                        <span class="fen-company {$vo['isread']==0?'red':'green'}">
                                            <if condition="in_array($vo['id'], $boldIds)">
                                                <b>{$vo.jc}</b>
                                            <else/>
                                                {$vo.jc}
                                            </if>
                                        </span>
                                        <if condition="!empty($vo['qq'])">
                                            <a href="http://wpa.qq.com/msgrd?v=3&uin={$vo.qq}&site=qq&menu=yes"
                                               target="_blank"><i class="relation_icon icon_qq"></i></a>
                                        </if>
                                        <if condition="!empty($vo['qq1'])">
                                            <a href="http://wpa.qq.com/msgrd?v=3&uin={$vo.qq1}&site=qq&menu=yes"
                                               target="_blank"><i class="relation_icon icon_qq"></i></a>
                                        </if>
                                    </div>
                                </div>
                            </volist>
                        </div>

                    <if condition="$info['on'] EQ 4 AND in_array($info['type_fw'],array(1,2))">
                        <div class="order-tool col-xs-12 no-padding mt3 order-tool-open">
                    <else/>
                        <div class="order-tool col-xs-12 no-padding mt3">
                    </if>
                        <div class="col-xs-12 no-padding mt3">
                            <div id="icon_email_send" class="pull-left cursor lh16" title="点击发送短信">
                                <if condition="$smsCount EQ 0">
                                    <i class="relation_icon icon_email" title="发送短信"></i>
                                <else/>
                                    <i class="relation_icon icon_email icon_email_open" title="短信通知已发送"></i>
                                </if>
                                <span>通知业主</span>
                            </div>
                            <div id="icon_weixin" class="pull-left cursor lh16" title="点击发送微信">
                                <if condition="$wxMark EQ 0">
                                    <i class="relation_icon icon_weixin2" title="发送微信"></i>
                                <else/>
                                    <i class="relation_icon icon_weixin1" title="微信已发送"></i>
                                </if>
                                <span>通知装修公司</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12 pull-left cursor lh16">
                        <button id="distance_check" type="button" class="btn btn-xl btn-info"
                                style="float:left; width: auto;margin-left: 10px; " data-status="0">距离查询
                        </button>
                        <button id="cancel_check" type="button" class="btn-sm"
                                style="float: right; width: 60px; height: 30px;">撤消
                        </button>
                    </div>
                    <div class="col-xs-12 no-padding">
                        <span>装修公司</span>
                        <i class="fa fa-exclamation-circle" data-html="true" data-toggle="tooltip" data-placement="right" title="红色：会员未绑定微信；<br>绿色：会员已绑定微信；<br>黄色：当城市会员>=6家时，1.0会员分单超出上限；<br>灰色：2.0会员不可分单；<br>“签”字：会员为2.0会员"></i>
                    </div>
                    <div class="col-xs-12 no-padding mt3" id="nowCompanys">
                        <volist name="nowCompanys" id="vo">
                            <p class="red">【{$vo.qz_area}】</p>
                            <div class="col-xs-12 no-padding">
                                <volist name="vo.child" id="v">
                                    <div class="col-xs-6 no-padding">
                                        <label>
                                            <if condition="isset($v['un_package_change']) ">
                                                <input type="checkbox" class="mr5" data-id="{$v.id}" data-name="{$v.jc}"
                                                       name="fen_company" data-type="{$v.classid}"
                                                       data-mode="{$v.cooperate_mode}" disabled
                                                <if condition="$v['ischeck'] EQ 1">checked</if>
                                                >
                                            <elseif condition="isset($v['un_new_qian_change'])"/>
                                                <input type="checkbox" class="mr5" data-id="{$v.id}" data-name="{$v.jc}"
                                                       name="fen_company" data-type="{$v.classid}"
                                                       data-mode="{$v.cooperate_mode}" disabled
                                                <if condition="$v['ischeck'] EQ 1">checked</if>
                                                >
                                            <elseif condition="isset($v['ischeck'])"/>
                                                <input type="checkbox" class="mr5" data-id="{$v.id}" data-name="{$v.jc}"
                                                       name="fen_company" data-type="{$v.classid}"
                                                       data-mode="{$v.cooperate_mode}" checked
                                                <if condition="$v['no_change'] eq 1">disabled</if>
                                                >
                                            <else/>
                                               <input type="checkbox" class="mr5" data-id="{$v.id}" data-name="{$v.jc}" name="fen_company" data-type="{$v.classid}" data-mode="{$v.cooperate_mode}">
                                            </if>

                                            <if condition="isset($v['new_qian_color']) AND $v['new_qian_color'] eq 2">
                                                <span style="color: gray" data-toggle="tooltip" data-placement="top" title="{$v.more_extra|default=''}">
                                                    <if condition="in_array($v['id'], $boldIds)">
                                                        <b>{$v.jc}</b>
                                                    <else/>
                                                        {$v.jc}
                                                    </if>
                                                </span>
                                            <elseif condition="isset($v['user_order_limit_state']) AND $v['user_order_limit_state'] eq 1"/>
                                                <span style="color: #f7b10b" data-toggle="tooltip" data-placement="top" title="{$v.more_extra|default=''}">
                                                    <if condition="in_array($v['id'], $boldIds)">
                                                        <b>{$v.jc}</b>
                                                    <else/>
                                                        {$v.jc}
                                                    </if>
                                                </span>
                                            <elseif condition="$v['wxcount'] GT 0" />
                                                <span class="green" data-toggle="tooltip" data-placement="top"
                                                      title="{$v.more_extra|default=''}" style="height: auto;">
                                                    <if condition="in_array($v['id'], $boldIds)">
                                                        <b>{$v.jc}</b>
                                                    <else/>
                                                        {$v.jc}
                                                    </if>
                                                </span>
                                            <else/>
                                                <span class="red" data-toggle="tooltip" data-placement="top" title="{$v.more_extra|default=''}" style="height: auto;">
                                                    <if condition="in_array($v['id'], $boldIds)">
                                                        <b>{$v.jc}</b>
                                                    <else/>
                                                        {$v.jc}
                                                    </if>
                                                </span>
                                            </if>
                                            <span class="green">[{$v.fen|default=0},{$v.qiang|default=0},{$v.zen|default=0}<if
                                                    condition="$v['cooperate_mode'] EQ 2">,{$v.round_order_number}</if>]</span>
                                            <if condition="isset($v['end_time'])">
                                                <span class="red">到 {$v.end_time}</span>
                                            </if>
                                            <if condition="isset($v['newMark'])">
                                                <span class="green">新</span>
                                            </if>
                                            <span class="green">
                                                <switch name="v.viptype">
                                                <case value="0.5">半</case>
                                                <case value="1.5">一倍半</case>
                                                <case value="2">双</case>
                                                <case value="2.5">二倍半</case>
                                                <case value="3">三</case>
                                                <case value="3.5">三倍半</case>
                                                <case value="4">四</case>
                                                <case value="4.5">四倍半</case>
                                                <case value="5">五</case>
                                                <case value="5.5">五倍半</case>
                                                <case value="6">六</case>
                                                <case value="6.5">六倍半</case>
                                                <case value="7">七</case>
                                                <case value="7.5">七倍半</case>
                                                <case value="8">八</case>
                                                <case value="8.5">八倍半</case>
                                                <case value="9">九</case>
                                                <case value="9.5">九倍半</case>
                                                <case value="10">十</case>
                                                </switch>
                                                </span>
                                            <if condition="isset($v['cooperation_name'])">
                                                <span class="green">{$v['cooperation_name']}</span>
                                            </if>
                                            <span data-id="{$v.id}" class="distance"
                                                  style="color: #3399FF;display: none">{$v.distance}</span>
                                            <if condition="isset($v['qianMark'])">
                                                <span class="green">返</span>
                                            </if>
                                            <if condition="$v['cooperate_mode'] EQ 2">
                                                <span class="green">签</span>
                                            </if>
                                            <if condition="in_array($v['cooperate_mode'] ,array(3,4) )">
                                                <span class="green">标</span>
                                            </if>
                                        </label>
                                    </div>
                                </volist>
                            </div>
                        </volist>
                    </div>
                    <div class="col-xs-12 no-padding mt3">
                        <span >已分配订单过期会员：</span>
                        <div>
                        <volist name="lostFenCompany" id="vo">
                            <div class="col-xs-4 no-padding">
                                <input type="checkbox" class="mr5" data-id="{$vo.id}" data-name="{$vo.jc}" name="fen_company" data-type="{$vo.classid}" data-mode="{$vo.cooperate_mode}" checked disabled="disabled" data-type-fw="{$vo.type_fw}">
                                <span class="text-center" style="padding:0 5px;height: auto; color: #b2b2b2;">{$vo.jc}</span>
                            </div>
                        </volist>
                        </div>
                    </div>
                    <div class="col-xs-12 no-padding mt3">
                        <span>{$info.cname}上次分配公司：</span>
                        <div>
                            <volist name="fenpei_now_company" id="vo">
                                <if condition="in_array($vo['id'], $boldIds)">
                                    <span class="col-xs-3 text-center"
                                          style="padding:0 5px;font-weight: bold;height: auto;">{$vo.jc}</span>
                                    <else/>
                                    <span class="col-xs-3 text-center" style="padding:0 5px;height: auto;">{$vo.jc}</span>
                                </if>
                            </volist>
                        </div>
                    </div>
                    <div class="col-xs-12 no-padding mt3">
                        <span>最近30天过期会员：</span>
                        <div class="row">
                            <volist name="lostCompany" id="vo">
                                <div class="col-sm-3 text-center" style="padding: 0 3px;">
                                    <if condition="$vo['cooperate_mode'] EQ 2">
                                        <span class="red">{$vo.jc}</span>
                                    <else/>
                                        <span class="red">{$vo.jc}</span><span>已过期<i class="red">{$vo.day}</i>天</span>
                                    </if>
                                </div>
                            </volist>
                        </div>
                        <if condition="$gettype neq 4">
                            <button id="btnFen" class="btn btn-info btn-sm pull-right width_60">③分配</button>
                            <else/>
                            <!--用作审核成分单后显示分配按钮-->
                            <button id="btnFen" class="btn btn-info btn-sm pull-right width_60" style="display: none">
                                ③分配
                            </button>
                        </if>
                    </div>
                </div>
                <!-- 第三列 -->
                <div class="col-xs-4 padding10">
                    {$tmp}
                    <div class="col-xs-12 no-padding mt3" id="otherCompanys">
                        <div>相邻城市装修公司：</div>
                        <volist name="otherCompanys" id="vo">
                            <div class="col-xs-12 no-padding mt3">
                                <p class="red">【{$vo.cname}】</p>
                                <div class="col-xs-12 no-padding">
                                    <volist name="vo.child" id="v">
                                        <div class="col-xs-6 no-padding">
                                            <label>
                                                <if condition="$v['un_package_change'] EQ 1 ">
                                                    <input type="checkbox" class="mr5" data-id="{$v.id}"
                                                            data-name="{$v.jc}" name="fen_company"
                                                            data-type="{$v.classid}" data-mode="{$v.cooperate_mode}"
                                                            disabled
                                                            <if condition="$v['ischeck'] EQ 1">checked</if>
                                                    >
                                                <elseif condition="isset($v['un_new_qian_change'])"/>
                                                    <input type="checkbox" class="mr5" data-id="{$v.id}"
                                                            data-name="{$v.jc}" name="fen_company"
                                                            data-type="{$v.classid}" data-mode="{$v.cooperate_mode}"
                                                            disabled
                                                            <if condition="$v['ischeck'] EQ 1">checked</if>
                                                    >
                                                <elseif condition="isset($v['ischeck'])"/>
                                                    <input type="checkbox" class="mr5" data-id="{$v.id}"
                                                            data-name="{$v.jc}" name="fen_company"
                                                            data-type="{$v.classid}" data-mode="{$v.cooperate_mode}"
                                                            checked
                                                            <if condition="$v['no_change'] eq 1">disabled</if>
                                                    >
                                                <else/>
                                                    <input type="checkbox" class="mr5" data-id="{$v.id}" data-name="{$v.jc}" name="fen_company" data-type="{$v.classid}" data-mode="{$v.cooperate_mode}">
                                                </if>
                                                
                                                <if condition="isset($v['new_qian_color']) AND $v['new_qian_color'] eq 2">
                                                    <span style="color: gray" data-toggle="tooltip" data-placement="top" title="{$v.more_extra|default=''}">
                                                        <if condition="in_array($v['id'], $boldIds)">
                                                            <b>{$v.jc}</b>
                                                        <else/>
                                                            {$v.jc}
                                                        </if>
                                                    </span>
                                                <elseif condition="isset($v['user_order_limit_state']) AND $v['user_order_limit_state'] eq 1"/>
                                                    <span style="color: #f7b10b" data-toggle="tooltip" data-placement="top" title="{$v.more_extra|default=''}">
                                                        <if condition="in_array($v['id'], $boldIds)">
                                                            <b>{$v.jc}</b>
                                                        <else/>
                                                            {$v.jc}
                                                        </if>
                                                    </span>
                                                <elseif condition="$v['wxcount'] GT 0"/>
                                                    <span class="green" data-toggle="tooltip" data-placement="top" title="{$v.more_extra|default=''}" style="height: auto;">
                                                        <if condition="in_array($v['id'], $boldIds)">
                                                            <b>{$v.jc}</b>
                                                        <else/>
                                                            {$v.jc}
                                                        </if>
                                                    </span>
                                                <else/>
                                                    <span class="red" data-toggle="tooltip" data-placement="top"
                                                      title="{$v.more_extra|default=''}" style="height: auto;">
                                                        <if condition="in_array($v['id'], $boldIds)">
                                                            <b>{$v.jc}</b>
                                                        <else/>
                                                            {$v.jc}
                                                        </if>
                                                    </span>
                                                </if>
                                                <span class="green"> [{$v.fen|default=0},{$v.qiang|default=0},{$v.zen|default=0}<if
                                                    condition="$v['cooperate_mode'] EQ 2">,{$v.round_order_number}</if>]</span>
                                                <if condition="isset($v['end_time'])">
                                                    <span class="red">到 {$v.end_time}</span>
                                                </if>
                                                <if condition="isset($v['newMark'])">
                                                    <span class="green">新</span>
                                                </if>

                                                <span class="green">
                                                    <switch name="v.viptype">
                                                    <case value="0.5">半</case>
                                                    <case value="1.5">一倍半</case>
                                                    <case value="2">双</case>
                                                    <case value="2.5">二倍半</case>
                                                    <case value="3">三</case>
                                                    <case value="3.5">三倍半</case>
                                                    <case value="4">四</case>
                                                    <case value="4.5">四倍半</case>
                                                    <case value="5">五</case>
                                                    </switch>
                                                    </span>
                                                <if condition="isset($v['cooperation_name'])">
                                                    <span class="green">{$v['cooperation_name']}</span>
                                                </if>
                                                <if condition="isset($v['qianMark'])">
                                                    <span class="green">返</span>
                                                </if>
                                                <if condition="$v['cooperate_mode'] EQ 2">
                                                    <span class="green">签</span>
                                                </if>
                                                <span data-id="{$v.id}" class="distance"
                                                      style="color: #3399FF;display: none">{$v.distance}</span>
                                            </label>
                                        </div>
                                    </volist>
                                </div>
                            </div>
                            <div>
                                <span>{$vo.cname}上次分配公司：</span>
                                <div>
                                    <volist name="vo.fen_company" id="v">
                                        <if condition="in_array($v['id'], $boldIds)">
                                            <span class="text-center"
                                                  style="padding:0 5px;font-weight: bold;height: auto;">{$v.jc}</span>
                                            <else/>
                                            <span class="text-center" style="padding:0 5px;height: auto;">{$v.jc}</span>
                                        </if>
                                    </volist>
                                </div>
                                <br style="clear: both;"/>
                            </div>
                        </volist>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    <div class="mask"></div>

    <div class="show_callnum_pop pop_set">
        <div class="show_num_header"><span>申请显号</span></div>
        <div class="show_num_body">
            <div class="show_num_item"><span class="pull-left show_num_tit">申请人：</span><span class="pull-left">{$Think.session.uc_userinfo.name}</span>
            </div>
            <div class="show_num_item"><span class="pull-left show_num_tit">申请订单号：</span><span class="pull-left">{$info.id}</span>
            </div>
            <div class="show_num_item"><span class="pull-left show_num_tit">申请理由：</span>
                <textarea class="pull-left"></textarea>
            </div>
        </div>
        <div class="show_num_footer">
            <div class="btn btn-info callnum_pop_ok">确定</div>
            <div class="btn btn-default call_pop_close">关闭</div>
        </div>
    </div>
    <div class="col-xs-12 no-padding weixin-model">
        <div class="col-xs-12 no-padding fenpei-model-hd">
            <p class="ml10">发送微信</p>
        </div>
        <div class="col-xs-12 mt20 zxgs-list text-center ">
            <volist name="company" id="vo">
                <div class="col-xs-6 no-padding mt10">
                    <label>
                        <input id="wx_company_{$key}" type="checkbox" name="wx_company" data-id="{$vo.id}" checked>
                        <label for="wx_company_{$key}" class="company-name">{$vo.jc}</label>
                    </label>
                </div>
            </volist>
        </div>
        <div class="text-center">
            <div class="btn btn-info btn-sm btn-ok">发送</div>
            <div class="btn btn-default btn-sm btn-close">关闭</div>
        </div>
    </div>
    <div class="col-xs-12 no-padding fenpei-model">
        <div class="col-xs-12 no-padding fenpei-model-hd">
            <p class="ml10">请选择分赠状态<span class="pull-right btn-close"
                                         style="line-height: 20px; margin-right: 10px; cursor: pointer;">X</span></p>
        </div>
        <div class="col-xs-12 mt20 zxgs-list zxgs-fen-list text-center">
        </div>
        <div class="text-center">
            <div id="btnUp" class="btn btn-info btn-sm btn-ok" style="float:right;">③分配</div>
        </div>
    </div>
    <input type="hidden" name="dwz" value="{$info.dwz}"/>
    <div class="applygaiwk">
        <div class="applygaiwk_title">申请修改</div>
        <div class="applygaiwkhang">
            <span class="spantitle">申请人:</span>{$applyname}
        </div>
        <div class="applygaiwkhang">
            <span class="spantitle">订单号:</span>{$info.id}
        </div>
        <div class="applygaiwkhang">
            <span class="spantitle">申请理由:</span><textarea class="liyoutext" cols="30" rows="10"
                                                          maxlength="30"></textarea>
        </div>
        <div class="applygaiwkhang anniuwk">
            <span class="niuspan closegb">关闭</span><span class="niuspan sureniu" id="btnEdit">确定</span>
        </div>
    </div>
    <div id="cancelMask">
        <div id="cancelContent">
            <div class="col-xs-12 header">
                <span class="leftClose">订单撤消</span>
                <span id="rightClose">X</span>
            </div>

            <div class="col-xs-12">
                <span class="">撤消原因：</span> <br>
                <select id="cancelSelect" class="" style="width: 100%;height: 36px">
                    <option value="">请选择</option>
                    <option value="1">销售分赠错误修改</option>
                    <option value="2">工种、设计师、材料商发布</option>
                    <option value="3">同行、装修公司，施工队发布</option>
                    <option value="4">订单质量问题</option>
                    <option value="5">重复订单</option>
                    <option value="6">更改订单编辑内容</option>
                    <option value="7">需要再次电话确认</option>
                    <option value="8">订单分赠性质更改</option>
                    <option value="9">上下备注不一致</option>
                    <option value="10">转到下属城市</option>
                    <option value="11">压单</option>
                    <option value="99">其它</option>
                </select>
            </div>
                
            <if condition="count($company) gt 0">
                <div class="col-xs-12 cxtc">
                    <span>撤消提出方：</span> <br>
                    <select id="tic" name="tic">
                        <option value="">请选择</option>
                    </select>
                </div>
            </if>

            <div class="col-xs-12">
                <span>文字备注：</span> <br>
                <textarea name="" id="cancelTextarea" placeholder="请填写备注"></textarea>
            </div>

            <div class="col-xs-12">
                <span>图片备注：</span> <br>
                <input type="hidden" id="upload_limit" value="5">
                <div id="upload_adv_box">
                    <input id="imgUpload" type="file" multiple name="img_upload" value="上传"/>
                    <div id="files">
                        <input type="hidden" name="img_url" value="{$info.img_hidden_url|default=''}">
                    </div>
                </div>
            </div>

            <div class="col-xs-12 cancelBtn">
                <input type="hidden" id="allot_state" name="allot_state" value="{:(count($company) > 0 ? 1 : 2)}" />
                <button type="button" class="cancel-qued">确定撤消</button>
                <button type="button" class="cancel-qux">取消</button>
            </div>

        </div>
    </div>
    <div id="regain">
        <div class="item">
            <span class="title">是否确定撤消所分配订单</span>
            <div class="col-xs-12 header">
                <button class="regainAllow">确定</button>
                <button class="regainCancel">取消</button>
            </div>
        </div>
    </div>
</section>
<!-- 返点比例设置确认提示 -->

<script type="text/javascript">

    /*图片上传插件 S*/
    $(function () {
        init_data();

        function init_data(){
            //历史小区查询
            $.ajax({
                url: '/orders/xiaoquHistory',
                type: 'get',
                dataType: 'json',
                data: {
                    xiaoqu:$("[name=xiaoqu]").val(),
                    city:"{$info.cs}"
                },
            })
                .done(function(data) {
                    if (data.error_code == 0) {
                        if (data.data > 0) {
                            $("#history").addClass("blue");
                        }
                    }
                });
        }


        var $uploadLimit = $('#upload_limit'),
            $uploadAdvBox = $('#upload_adv_box'),
            $imgUrl = $('input[name="img_url"]');
        $("#imgUpload").fileinput({
            language: 'zh', //设置语言,
            uploadUrl: "/upload/uploadimg/",
            showCaption: false,
            browseClass: "btn blue",
            removeClass: "btn red",
            allowedFileExtensions: ['jpg', 'png', 'jpeg'],
            overwriteInitial: false,
            maxFileSize: 70000,
            maxFileCount: 5, // 这里设为0，由于存在bug，这个属性相当于没什么用了
            uploadClass: "btn green",
            removeClass: "btn red",
            uploadAsync: true,
            browseLabel: '选择',
            dropZoneEnabled: false,
            previewSettings: {
                image: {width: "auto", height: "100px"}
            },
            layoutTemplates: {
                actionUpload: "",
                actionDownload: ""
            },
            /* minImageWidth: 1205,
             minImageHeight: 405,
             maxImageWidth: 1205,
             maxImageHeight: 405,*/
            // maxFileSize: 100,
            msgFilesTooMany: "选择上传的文件数量({n}) 超过允许的最大数值{m}！",
            uploadExtraData: {
                prefix: 'back_img'
            },
            initialPreview: {$info.imgs |default = '[]'},
            initialPreviewAsData: true,
            initialPreviewFileType: 'image',
            initialPreviewConfig: {$info.previewconfig |default = '[]'},
        })
            .on('filebatchselected', function (evt, data, previewId, index,file) {
                // 选择图片后执行，用于判断选择的图片是否超出限制，这是为了弥补maxFileCount的bug
                if ($uploadAdvBox.find('.file-preview-frame').length >= $uploadLimit.val()) {
                    // 禁用选择按钮
                    $('#imgUpload').attr('disabled', 'disabled');
                    $('#imgUpload').closest('div.btn-file').addClass('btn-disabled');
                    // 禁用上传按钮
                    // $uploadAdvBox.find('.fileinput-upload-button').attr('disabled', 'disabled')
                }

                console.log(data)


                $('.file-preview-frame').click(function () {
                    layer.photos({
                        photos: '.file-preview-frame',
                        anim: 5 //0-6的选择，指定弹出图片动画类型，默认随机（请注意，3.0之前的版本用shift参数）
                    });
                });



            })
            .on('filebatchuploadcomplete', function (evt, file) {
                // 只会调用一次，所有图片都上传成功调用，这是为了弥补上传成功后部分DOM结构重新渲染，导致filebatchselected钩子中执行的操作失效
                if ($uploadAdvBox.find('.file-preview-frame').length > $uploadLimit.val()) {
                    $('#imgUpload').attr('disabled', 'disabled')
                    $('#imgUpload').closest('div.btn-file').addClass('btn-disabled');
                }
            })
            .on('fileuploaded', function (event, data, previewId, index) {
                // 上传成功几次就调用几次，把后端返回的地址附加到DOM结构上，为以后得操作做准备
                if (data.response.status == 1) {
                    $uploadAdvBox.find('#' + previewId).attr('data-url', data.response.data.name);
                } else {
                    alert(data.response.info);
                }
            })
            .on('fileclear', function (evt, file) {
                // 点击右上角叉叉执行
                $('#imgUpload').removeAttr('disabled')
                $('#imgUpload').closest('div.btn-file').removeClass('btn-disabled')
                $uploadAdvBox.find('.fileinput-upload-button').removeAttr('disabled')
            })
            .on("filesuccessremove", function (event, uploadedId, index) {
                // 仅对上传成功的图片有效，未上传的图片不执行这里
                // 通过uploadedId找到缓存的data-url，然后去匹配files中的文件，实现删除
                // 延迟一秒后删除，否则不准确
                setTimeout(function () {
                    if ($uploadAdvBox.find('.file-preview-frame').length < $uploadLimit.val()) {
                        $('#imgUpload').removeAttr('disabled')
                        $('#imgUpload').closest('div.btn-file').removeClass('btn-disabled')
                    }
                }, 1000)
            })
            .on('fileremoved', function () {
                // 该事件钩子针对只选择不上传的情况
                if ($uploadAdvBox.find('.file-preview-frame').length <= $uploadLimit.val()) {
                    $('#imgUpload').removeAttr('disabled')
                    $('#imgUpload').closest('div.btn-file').removeClass('btn-disabled')
                    $uploadAdvBox.find('.fileinput-upload-button').removeAttr('disabled')
                }
            })
        if ($imgUrl.val()) {
            // 给file-preview-frame元素附加data-url属性，用于提交的时候收集数据
            window.onload = function () {
                setTimeout(function () {
                    var $filePreviewFrame = $('.file-preview-frame');
                    $filePreviewFrame.each(function (index, item) {
                        var imgLink = $(item).find('img').attr('src')
                        if (imgLink) {
                            imgLink = imgLink.replace(/http:\/\/{:C('QINIU_DOMAIN')}\//, '')
                            $(item).attr('data-url', imgLink)
                        }
                    })
                }, 1000)
            }
            // 监听已上传图片的删除事件，针对插件未提供图片初始化删除事件钩子的情况
            $("#upload_adv_box").on("click", function (event) {
                var $target = $(event.target);
                if ($target[0].nodeName.toLowerCase() == "button" || $target[0].nodeName.toLowerCase() == "i") {
                    setTimeout(function () {
                        if ($uploadAdvBox.find('.file-preview-frame').length <= $uploadLimit.val()) {
                            $('#imgUpload').removeAttr('disabled')
                            $('#imgUpload').closest('div.btn-file').removeClass('btn-disabled')
                            $uploadAdvBox.find('.fileinput-upload-button').removeAttr('disabled')
                        }
                    }, 1000)
                }
            })
        }
    })
    /*图片上传插件 S*/

    $.fn.modal.Constructor.prototype.enforceFocus = function () {
        $("select[name=tic]").select2({
            ajax: {
                url: '/adminuser/getUserBuUser',
                method: "get",
                data: function (params) {
                    return {
                        user_name: params.term
                    }
                },
                processResults: function (data) {
                    var dataList = $.map(data.list, function (obj) {
                        obj.text = obj.user;
                        return obj;
                    });
                    return {
                        results: dataList
                    }
                },
            },
            escapeMarkup: function (markup) {
                return markup;
            }, // let our custom formatter work
            minimumInputLength: 1,
            templateResult: function (item) {
                return item.text;
            },
        })
    }

    $("body").on("click", "#cancel_check", function () {
        $("#cancelMask").show();
    });
    $("body").on("click", ".cancel-qux", function () {
        $("#cancelMask").hide();
    });
    $("body").on("click", "#rightClose", function () {
        $("#cancelMask").hide();
    });

    $("#cancelContent .cancel-qued").click(function () {
        var id = "{$info.id}";
        var remark = $('#cancelTextarea').val();
        var reason = $("#cancelSelect").val();
        var backId = $('select[name=tic]').val();
        var allot_state = $("input[name=allot_state]").val();

        if (reason == '') {
            alert("请选择撤消原因");
            return false;
        }

        if(!backId && allot_state == 1){
            alert('请选择撤消提出方');
            return false;
        }

        $("#regain").show();
    });

    $(".regainAllow").click(function () {
        var id = "{$info.id}";
        var remark = $('#cancelTextarea').val();
        var reason = $("#cancelSelect").val();
        var backId = $('select[name=tic]').val();
        var allot_state = $("input[name=allot_state]").val();

        var imgUrl = ""
        $uploadAdvBox = $('#upload_adv_box');
        $uploadAdvBox.find('.file-preview-frame').each(function (index, item) {
            imgUrl += $(item).attr('data-url') + ','
        });

        $.ajax({
            url: '/orders/orderBackOption/',
            type: 'POST',
            dataType: 'JSON',
            data: {
                id: id,
                reason: reason,
                push_uid: backId,
                remark: remark,
                img: imgUrl,
                allot_state: allot_state
            }
        }).done(function (data) {
            if (data.error_code == 0) {
                alert("撤消成功");
                $("#cancelMask").hide()
                $("#regain").hide()
            } else {
                alert(data.error_msg);
            }
        });
    });

    $("body").on("click", ".regainCancel", function () {
        $("#regain").hide()
    });


    $("body").on("click", "#btnEdits", function () {
        $(".applygaiwk").show();
    })

    $('.applygaiwkhang .closegb').click(function () {
        $(".applygaiwk").hide();
    })


    tel_repeat();
    //备用联系鼠标移出
    $("#other_contact").on('blur', function () {
        $("#other_contact_span").text('');
        tel_repeat();
    })

    function tel_repeat() {
        var other_contact = trim($("#other_contact").val());
        var phone = other_contact.replace(/[^0-9]/g, "");
        if (phone != '') {
            $.ajax({
                url: '/order/tel_repeat',
                type: 'POST',
                dataType: 'JSON',
                data: {
                    phone: phone
                }
            })
                .done(function (data) {
                    if (data.status == 0) {
                        $("#other_contact_span").text(data.info);
                    }
                });
        }
    }

    $('.datepicker').datetimepicker({
        weekStart: 1,
        todayHighlight: 1,
        todayBtn: true,
        minView: 0,
        pickerPosition: "bottom-left",
        autoclose: true
    });
    $(".hf_datepicker").datetimepicker({
        minView: "month",
        format: 'yyyy-mm-dd',
        minViewMode: 0,
        startDate: new Date(),
        endDate: '+1m',
        pickerPosition: "top-left",
        todayBtn: true,
        clearBtn: 1,
        autoclose: true
    });

    $(".remove_btn").click(function () {
        $('input[name="visitime"]').val('');
    })
    $(".remove_hf_btn").click(function () {
        $('input[name="review_time"]').val('');
    })

    $(".lf_datepicker").datepicker({
        format: "yyyy-mm-dd",
        minViewMode: 0,
        autoclose: true
    }).on('changeDate', function (ev) {
        var val = $("textarea[name=text]").val();
        val += " " + $("input[name=nf_time]").val();
        $("textarea[name=text]").val(val);
    });

    $('#icon_eye').on('click', function () {
        $('.show_callnum_pop').fadeIn();
        $('.mask').fadeIn();
    });

    $('.call_pop_close').on('click', function () {
        $('.call_pop').fadeOut();
        $('.show_callnum_pop').fadeOut();
        $('.mask').fadeOut();
    });

    $('.callnum_pop_ok').on('click', function () {
        $.ajax({
            url: '/order/tel_openeye',
            type: 'POST',
            dataType: 'JSON',
            data: {
                id: '{$info.id}',
                "text": $('.show_callnum_pop textarea').val()
            }
        })
            .done(function (data) {
                if (data.code == 200) {
                    $('.show_callnum_pop').fadeOut();
                    $('.mask').fadeOut();
                } else {
                    alert(data.errmsg || data.info);
                }
            });
    });

    $("#icon_email").click(function (event) {
        var _this = $(this);

        if (_this.hasClass('icon_email_disabled')) {
            return false;
        }

        if (!confirm("确定发送短信通知?")) {
            return false;
        }

        $.ajax({
            url: '/sms/sendsms/',
            type: 'POST',
            dataType: 'JSON',
            data: {
                id: "{$info.id}"
            }
        })
            .done(function (data) {
                if (data.code == 200) {
                    alert("短信发送成功！");
                    _this.addClass('icon_email_disabled');
                } else {
                    alert(data.errmsg || data.info);
                }
            });
    });


    $('.select_order_state').on('change', function () {
        var id = $(this).val();
        $('.select_order_item').addClass('hide_select');
        $("#" + id).removeClass('hide_select');
        $('.order_note').show();
        if ($("#" + id).length == 0) {
            $('.order_note').hide();
        }
    });
    $('.select_order_state').trigger('change');

    // 钥匙选择字体变化
    $('.key_select').on('change', function () {
        if ($('.key_select option:selected').val() == '1') {
            $(this).removeClass('red').addClass('green').addClass('key_select_option');
        } else if ($('.key_select option:selected').val() == '0') {
            $(this).removeClass('green').addClass('red').addClass('key_select_option');
        } else {
            $(this).removeClass('green').removeClass('red').removeClass('key_select_option');
        }
    });
    $('.key_select').trigger('change');

    $(".icon_headset").click(function (event) {
        var _this = $(this);
        if (!confirm("确定IP话机拨打电话?")) {
            return false;
        }
        ;
        $.ajax({
            url: '/voip/tel_voipcallback',
            type: 'POST',
            dataType: 'JSON',
            data: {
                id: _this.attr("data-id")
            }
        })
            .done(function (data) {
                if (data.code == 200) {
                    alert(data.errmsg);
                } else {
                    alert(data.errmsg || data.info);
                }
            });
    });

    $('.call_pop_close').on('click', function () {
        $('.call_pop').fadeOut();
        $('.show_callnum_pop').fadeOut();
        $('.mask').fadeOut();
        $('body').css('overflowY', 'auto');
    });


    $("#btnCheck").on("click", function (event) {
        var _this = $(this);
        var status = $(".select_order_state").val();
        var sub_status = $("#" + status).val();
        if ($(".select_order_state").val() == "remark_2" && $(".select_order_item").val() == "") {
            alert("请选择备注");
            return;
        }
        if ($(".select_order_state").val() == "remark_7") {
            if (!confirm("是否确认直接赠送给装修公司（确认后，不可更改业主信息）")) {
                return;
            }
        }
        if (!status) {
            alert("请选择订单状态后 , 再审核");
            return;
        }
        $.ajax({
            url: '/orders/orderdockingstatus/',
            type: 'POST',
            dataType: 'JSON',
            data: {
                id: "{$info.id}",
                status: status,
                sub_status: sub_status,
                gettype: {$gettype},
                check_data: {
                    lftime: $("select[name=lftime]").val()
                }
            }
        })
            .done(function (data) {
                if (data.code == 200) {
                    _this.attr('disabled', true);
                    alert("订单审核操作成功！");
                    switch (status) {
                        //如果 对接操作 选择的是分单 , 则显示分配按钮
                        case 'remark_5':
                            $("#btnFen").show();
                            break;
                        //如果 对接操作 选择的是[推送抢单池]/[直接赠送] , 则隐藏分配按钮
                        case 'remark_6':
                        case 'remark_8':
                        case 'remark_7':
                            $("#btnFen").hide();
                            break;
                    }
                } else {
                    alert(data.errmsg || data.info);
                }
            });
    });

    $("#icon_weixin").click(function (event) {
        $('.weixin-model').fadeIn(200);
        $(".mask").show();
    });

    $("#icon_email_send").click(function (event) {
        if (confirm("确定发送短信吗?")) {
            $.ajax({
                url: '/orders/sendsms/',
                type: 'POST',
                dataType: 'JSON',
                data: {
                    id: "{$info.id}"
                }
            })
                .done(function (data) {
                    if (data.code == 200) {
                        alert("短信发送成功！");
                        $(".icon_email").addClass('icon_email_open').attr("title", "短信已发送");
                    } else {
                        alert(data.errmsg || data.info);
                    }
                });
        }
        ;
    });

    $('.weixin-model').find('.btn-close').on('click', function () {
        $('.weixin-model').fadeOut(200);
        $('.mask').hide(200);
    });

    $('.weixin-model').find('.btn-ok').on('click', function () {
        var companys = new Array();
        var data = new Array();
        var _this = $(this);
        $("input[name=wx_company]").each(function () {
            if ($(this).prop("checked")) {
                companys.push($(this).attr("data-id"));
            }
            ;
        });
        data.push({
            name: "companys",
            value: companys
        });
        data.push({
            name: "id",
            value: "{$info.id}"
        });

        $.ajax({
            url: '/order/sendwx/',
            type: 'POST',
            dataType: 'JSON',
            data: data
        })
            .done(function (data) {
                alert(data.errmsg || data.info);
                if (data.code == 200) {
                    $('.weixin-model').fadeOut(200);
                    $('.mask').hide(200);
                    $("#icon_weixin").find(".icon_weixin2").addClass('icon_weixin1').removeClass('icon_weixin2');
                }
            });
    });

    $("#btnFen").click(function (event) {
        //可分配数
        var allot_num = '{$info.allot_num|default=4}';

        if ($("input[name=fen_company]:checked").length == 0) {
            alert("请选择分配装修公司");
            return false;
        }

        if ($("input[name=fen_company]:checked").length > allot_num) {
            alert("只能选择" + allot_num + "家装修公司");
            return false;
        }
        var tmp = "";
        $("input[name=fen_company]:checked").each(function () {
            if ($(this).attr("disabled") != "disabled") {
                tmp += '<div class="col-xs-6 no-padding mt20"><select name="select_company" class="pull-right" data-type="' + $(this).attr("data-type") + '" data-mode="' + $(this).attr("data-mode") + '" data-id="' + $(this).attr("data-id") + '"><option value="">-请选择-</option><option value="1">分单</option><option value="2">赠单</option></select><span class="zxgs-name pull-right mr10">' + $(this).attr("data-name") + '</span></div>';
            } else {
                var option = '<option value="">-请选择-</option>';
                if($(this).attr("data-type-fw") == "1"){
                     option = '<option value="1">分单</option>';
                } else if ($(this).attr("data-type-fw") == "2") {
                    option = '<option value="2">赠单</option>';
                }
                tmp += '<div class="col-xs-6 no-padding mt20"><select name="select_company" class="pull-right" data-type="' + $(this).attr("data-type") + '" data-mode="' + $(this).attr("data-mode") + '" data-id="' + $(this).attr("data-id") + '" disabled="disabled">'+option+'</select><span class="zxgs-name pull-right mr10">' + $(this).attr("data-name") + '</span></div>';
            }
        });
        $(".zxgs-fen-list").html(tmp);
        $('.fenpei-model').fadeIn(200);
        $('.mask').show(200);

    });

    // 取消分配
    $('.fenpei-model .btn-close').on('click', function () {
        $('.fenpei-model').fadeOut(200);
        $('.mask').fadeOut(200);
    });

    $("#btnUp").click(function (event) {
        var data = {};
        var compnay = new Array();
        data["id"] = "{$info.id}";
        data['type'] = "{$gettype}";
        data['lftime'] = "{$info['lftime']}";
        $(".zxgs-fen-list select").each(function () {
            compnay.push({
                company_id: $(this).attr("data-id"),
                "type_fw": $(this).val(),
                "classid": $(this).attr("data-type"),
                "mode": $(this).attr("data-mode")
            });
        });
        data["companys"] = compnay;

        $.ajax({
            url: '/orders/orderchange/',
            type: 'POST',
            dataType: 'JSON',
            data: data
        })
            .done(function (data) {
                if (data.error_code == 0 || data.code == 0) {
                    alert(data.error_msg);
                    if (data.info == 1) {
                        $(".icon_email").addClass('icon_email_open').attr("title", "短信已发送");
                    }

                    $('.fenpei-model .btn-close').trigger('click');
                    $(".order-tool").addClass('order-tool-open');
                    var compnays = data.data;
                    var tmp = "";
                    var qq, qq1 = "";
                    var type_fw = "";
                    var wx_tmp = "";
                    for (var i in compnays) {
                        if (parseInt(compnays[i].type_fw) == 1) {
                            type_fw = "分";
                        } else {
                            type_fw = "赠"
                        }

                        if (compnays[i].qq !== "") {
                            qq = '<a href="http://wpa.qq.com/msgrd?v=3&uin=' + compnays[i].qq + '&site=qq&menu=yes" target="_blank"><i class="relation_icon icon_qq"></i></a>';
                        }

                        if (compnays[i].qq1 !== "") {
                            qq1 = '<a href="http://wpa.qq.com/msgrd?v=3&uin=' + compnays[i].qq1 + '&site=qq&menu=yes" target="_blank"><i class="relation_icon icon_qq"></i></a>';
                        }

                        tmp += '<div class="col-xs-6 no-padding"><span>' + type_fw + '</span><span class="red fen-company">' + compnays[i].jc + '</span>' + qq + ' ' + qq1 + '</div></div>';

                        wx_tmp += '<div class="col-xs-6 no-padding mt10"><label><input id="wx_company_' + i + '" type="checkbox" name="wx_company" data-id="' + compnays[i].id + '" checked><label for="wx_company_' + i + '" class="company-name"></label>' + compnays[i].jc + '</label></div>';

                    }
                    $(".weixin-model .zxgs-list").html(wx_tmp);
                    $(".wx_company_list").html(tmp);
                } else {
                    alert(data.error_msg || data.info);
                }
            });
    });

    $("#history").click(function (event) {
        BootstrapDialog.show({
            title: "历史签单小区",
            message: function (dialog) {
                var $message = $('<div style="margin:-15px; overflow-y:auto; max-height:400px;"></div>');
                var pageToLoad = dialog.getData('pageToLoad');
                $message.load(pageToLoad);

                return $message;
            },
            data: {
                'pageToLoad': '/order/history?xiaoqu={$info.xiaoqu}&cs={$info.cs}'
            },
            type: BootstrapDialog.TYPE_DEFAULT,
            onshow: function (e) {
                e.$modalDialog.css("width", "400px");
            }
        });
    });

    /*小区input下拉*/
    $(".xiaoqu-entry").click(function (event) {
        $(".xiaoqu-box").show();
        if ($(".xiaoqu-box").val() == "") {
            $(".xiaoqu-box ul li").click(function () {
                $('.xiaoqu-entry').val($(this).html());
                //小区道路显示
                $("select[name=xiaoqutype]").val($(this).attr("data-type"));
                //坐标显示
                $("input[name=zuobiao]").val($(this).attr("data-jw"));
                $(".xiaoqu-box").hide();
            })
        }

        $('.xiaoqu-entry').change(function () {
            $(".xiaoqu-box").show();
            var result = $('.xiaoqu-entry').val();
            for (var i = 0; i < $(".xiaoqu-box ul li").length; i++) {
                var oLiResult = $(".xiaoqu-box ul li").eq(i).html();
                if (oLiResult.indexOf(result) != -1) {
                    $(".xiaoqu-box ul li").eq(i).show();
                    $(".xiaoqu-box ul li").eq(i).click(function () {
                        $('.xiaoqu-entry').val($(this).html());
                        $("input[name=zuobiao]").val($(this).attr("data-jw"));
                        $(".xiaoqu-box").hide();
                    })
                } else {
                    $(".xiaoqu-box ul li").eq(i).hide();
                }
            }
        })
        event.stopPropagation();
    })
    $(window).click(function () {
        $(".xiaoqu-box").hide();
    })

    $("#btnNoNew").click(function (event) {
        BootstrapDialog.show({
            title: "不能生成原因",
            message: function (dialog) {
                var $message = $('<textarea id="content" placeholder="填写原因"></textarea>');
                return $message;
            },
            type: BootstrapDialog.TYPE_INFO,
            buttons: [{
                label: '确定',
                action: function (dialogItself) {
                    $.ajax({
                        url: '/order/ordertonewchange',
                        type: 'POST',
                        dataType: 'JSON',
                        data: {
                            id: '{$info.id}',
                            "text": $("#content").val()
                        },
                    })
                        .done(function (data) {
                            if (data.code == 200) {
                                alert("操作成功！");
                                $(".my-dialog").modal("hide");
                            } else {
                                alert(data.errmsg || data.info);
                            }
                        });
                    dialogItself.close();
                }
            }, {
                label: '关闭',
                action: function (dialogItself) {
                    dialogItself.close();
                },
                cssClass: 'pull-left'
            }]
        });
    });

    $("#order-form input[type=text]:not(input[name=nf_time],input[name=xiaoqu])").blur(function (event) {
        var val = $("textarea[name=text]").val();
        val += " " + $(this).val();
        $("textarea[name=text]").val(val);
    });

    $("#order-form select:not(select[name=qx])").change(function (event) {
        var val = $("textarea[name=text]").val();
        val += " " + $(this).find("option:selected").text();
        $("textarea[name=text]").val(val);
    });

    $("#btnNew").click(function (event) {
        if (confirm("确定生成新单吗？")) {
            $.ajax({
                url: '/order/ordernftoneworder',
                type: 'POST',
                dataType: 'JSON',
                data: {
                    id: '{$info.id}'
                },
            })
                .done(function (data) {
                    if (data.code == 200) {
                        alert(data.errmsg);
                        $(".my-dialog").modal("hide");
                    } else {
                        alert(data.errmsg || data.info);
                    }
                });
        }
    });

    //修改区域,获取对应区域的小区名称
    $("input[name=xiaoqu]").on("input propertychange", function () {
        var cs = $('input[name=cs]').val();
        var xiaoqu = $.trim($("input[name=xiaoqu]").val());
        if (cs != '' && xiaoqu != '') {
            $.ajax({
                url: '/orders/getcommunitybycity/',
                type: 'GET',
                dataType: 'JSON',
                data: {
                    cs: cs, xiaoqu: xiaoqu

                }
            })
                .done(function (data) {
                    if (data.status == 0) {
                        //下拉框内容
                        $("#xiaoqu_ul").html(data.data);
                        $(".xiaoqu-box").show();
                    } else {
                        alert(data.errmsg || data.info);
                    }
                });
        }
    });

    //保存
    $("#btnSave").on("click", function (event) {
        if (confirm("保存后将不可再次修改，是否确定保存？")) {
            //小区名不为空
            var xiaoqu = $.trim($("input[name=xiaoqu]").val());
//        if(xiaoqu== ''){
//            alert("请填写小区名");
//            return false;
//        }else{
//            var regex = new RegExp("^([\u4E00-\uFA29]|[\uE7C7-\uE7F3]|[a-zA-Z0-9_]){1,20}$");
//            if(!regex.test(xiaoqu)){
//                alert("小区名称只允许输入数字字母中文");
//                return false;
//            }
//        }
            //经纬度不为空
//        if($("input[name=zuobiao]").val() == ''){
//            alert("请填写经纬度");
//            return false;
//        }
            //量房时间不为空
            // if($("select[name=lftime]").val() == ''){
            //     alert("请填写量房时间");
            //     return false;
            // }

            var data = $("#myForm").serializeArray();
            data.push({
                name: "id",
                value: "{$info.id}"
            });
            data.push({
                name: "pagetype",
                value: 2
            });

            $.ajax({
                url: '/orders/orderup/',
                type: 'POST',
                dataType: 'JSON',
                data: data
            })
                .done(function (data) {
                    if (data.code == 200) {
                        alert("业主信息保存成功");
                        $("#btnSave").hide();
                    } else {
                        alert(data.errmsg || data.info);
                    }
                });
        }
    });
    //申请修改
    $("#btnEdit").on("click", function (event) {
        var orders = "{$info.id}";
        var reason = $('.liyoutext').val();

        $.ajax({
            url: '/orders/applyedit/',
            type: 'POST',
            dataType: 'JSON',
            data: {orders: orders, reason: reason}
        })
            .done(function (data) {
                if (data.code == 200) {
                    alert("申请成功");
                    window.location.reload();
//                        $(".applygaiwk").hide();
//                        $("#btnEdits").hide();
                } else {
                    alert(data.errmsg);
                }
            });
    });

    $('.modifyrizhi').click(function () {
        var _this = $(this);
        $.ajax({
            url: '/orders/getorderfieldstat',
            type: 'POST',
            dataType: 'JSON',
            data: {id: _this.attr("data-id")}
        })
            .done(function (data) {
                if (data.status == 1) {
                    _this.parents(".border-r").append(data.data)
                } else {
                    alert(data.info);
                }
            });
    });

    $("#equalphone").on('click', function () {
        if ($(this).is(':checked') == true) {
            if ($("#contact_wx").val().length > 0) {
                $(this).removeAttr('checked');
                alert('请将微信编辑清空后，再勾选“手机同号”复选框。');
                return;
            }
            $("#contact_wx").attr('disabled', true);
        } else {
            $("#contact_wx").removeAttr('disabled');
        }
    });
</script>
